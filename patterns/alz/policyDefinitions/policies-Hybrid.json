{
  "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.34.44.8038",
      "templateHash": "15346296132372528543"
    }
  },
  "parameters": {
    "topLevelManagementGroupPrefix": {
      "type": "string",
      "defaultValue": "alz",
      "metadata": {
        "message": "The JSON version of this file is programatically generated from Bicep. PLEASE DO NOT UPDATE MANUALLY!!",
        "description": "Provide a prefix (unique at tenant-scope) for the Management Group hierarchy and other resources created as part of an Azure landing zone. DEFAULT VALUE = \"alz\""
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[deployment().location]",
      "metadata": {
        "description": "Optionally set the deployment location for policies with Deploy If Not Exists effect. DEFAULT VALUE = \"deployment().location\""
      }
    },
    "scope": {
      "type": "string",
      "defaultValue": "[tenantResourceId('Microsoft.Management/managementGroups', parameters('topLevelManagementGroupPrefix'))]",
      "metadata": {
        "description": "Optionally set the scope for custom Policy Definitions used in Policy Set Definitions (Initiatives). Must be one of '/', '/subscriptions/id' or '/providers/Microsoft.Management/managementGroups/id'. DEFAULT VALUE = '/providers/Microsoft.Management/managementGroups/${topLevelManagementGroupPrefix}'"
      }
    }
  },
  "variables": {
    "copy": [
      {
        "name": "processPolicyDefinitionsAll",
        "count": "[length(variables('loadPolicyDefinitions').All)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').All[copyIndex('processPolicyDefinitionsAll')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureCloud",
        "count": "[length(variables('loadPolicyDefinitions').AzureCloud)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureCloud[copyIndex('processPolicyDefinitionsAzureCloud')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureChinaCloud",
        "count": "[length(variables('loadPolicyDefinitions').AzureChinaCloud)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureChinaCloud[copyIndex('processPolicyDefinitionsAzureChinaCloud')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureUSGovernment",
        "count": "[length(variables('loadPolicyDefinitions').AzureUSGovernment)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureUSGovernment[copyIndex('processPolicyDefinitionsAzureUSGovernment')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicySetDefinitionsAll",
        "count": "[length(variables('loadPolicySetDefinitions').All)]",
        "input": "[replace(variables('loadPolicySetDefinitions').All[copyIndex('processPolicySetDefinitionsAll')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureCloud",
        "count": "[length(variables('loadPolicySetDefinitions').AzureCloud)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureCloud[copyIndex('processPolicySetDefinitionsAzureCloud')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureChinaCloud",
        "count": "[length(variables('loadPolicySetDefinitions').AzureChinaCloud)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureChinaCloud[copyIndex('processPolicySetDefinitionsAzureChinaCloud')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureUSGovernment",
        "count": "[length(variables('loadPolicySetDefinitions').AzureUSGovernment)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureUSGovernment[copyIndex('processPolicySetDefinitionsAzureUSGovernment')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "policyDefinitionsAll",
        "count": "[length(variables('processPolicyDefinitionsAll'))]",
        "input": "[json(variables('processPolicyDefinitionsAll')[copyIndex('policyDefinitionsAll')])]"
      },
      {
        "name": "policyDefinitionsAzureCloud",
        "count": "[length(variables('processPolicyDefinitionsAzureCloud'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureCloud')[copyIndex('policyDefinitionsAzureCloud')])]"
      },
      {
        "name": "policyDefinitionsAzureChinaCloud",
        "count": "[length(variables('processPolicyDefinitionsAzureChinaCloud'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureChinaCloud')[copyIndex('policyDefinitionsAzureChinaCloud')])]"
      },
      {
        "name": "policyDefinitionsAzureUSGovernment",
        "count": "[length(variables('processPolicyDefinitionsAzureUSGovernment'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureUSGovernment')[copyIndex('policyDefinitionsAzureUSGovernment')])]"
      },
      {
        "name": "policySetDefinitionsAll",
        "count": "[length(variables('processPolicySetDefinitionsAll'))]",
        "input": "[json(variables('processPolicySetDefinitionsAll')[copyIndex('policySetDefinitionsAll')])]"
      },
      {
        "name": "policySetDefinitionsAzureCloud",
        "count": "[length(variables('processPolicySetDefinitionsAzureCloud'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureCloud')[copyIndex('policySetDefinitionsAzureCloud')])]"
      },
      {
        "name": "policySetDefinitionsAzureChinaCloud",
        "count": "[length(variables('processPolicySetDefinitionsAzureChinaCloud'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureChinaCloud')[copyIndex('policySetDefinitionsAzureChinaCloud')])]"
      },
      {
        "name": "policySetDefinitionsAzureUSGovernment",
        "count": "[length(variables('processPolicySetDefinitionsAzureUSGovernment'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureUSGovernment')[copyIndex('policySetDefinitionsAzureUSGovernment')])]"
      }
    ],
    "$fxv#0": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_dataDiskReadLatency_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM Data Disk Read Latency Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM Disk Read Latency Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.7.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"30\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMHighDataDiskReadLatencyAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"ReadLatencyMs\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk !in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-ReadLatencyMs-Data-threshold-Override_', '_amba-ExcludedLogicalVolumes-ReadLatency_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMdataDiskReadLatencyAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMHighDataDiskReadLatencyAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMHighDataDiskReadLatencyAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine dataDiskReadLatency\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"ReadLatencyMs\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk !in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-ReadLatencyMs-Data-threshold-Override_', '_amba-ExcludedLogicalVolumes-ReadLatency_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      },\r\n                                      {\r\n                                        \"name\": \"Disk\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#1": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_dataDiskSpace_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM Data Disk Space Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM Data Disk Space Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.7.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"10\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMLowDataDiskSpaceAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"FreeSpacePercentage\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk !in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue < appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-FreeSpacePercentage-Data-threshold-Override_', '_amba-ExcludedLogicalVolumes-DiskSpace_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMdataDiskSpaceAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMLowDataDiskSpaceAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMLowDataDiskSpaceAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine dataDiskSpace\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"FreeSpacePercentage\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk !in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue < appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-FreeSpacePercentage-Data-threshold-Override_', '_amba-ExcludedLogicalVolumes-DiskSpace_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      },\r\n                                      {\r\n                                        \"name\": \"Disk\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#10": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_Memory_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM Memory Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM Memory Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.6.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"10\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMLowMemoryAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"Memory\\\" and Name == \\\"AvailableMB\\\" | extend TotalMemory = toreal(todynamic(Tags)[\\\"vm.azm.ms/memorySizeMB\\\"]) | extend AvailableMemoryPercentage = (toreal(Val) / TotalMemory) * 100.0 | summarize AggregatedValue = avg(AvailableMemoryPercentage) by bin(TimeGenerated, 15m), Computer, _ResourceId | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue < appliedThreshold | project TimeGenerated, Computer, _ResourceId, AggregatedValue, appliedThreshold', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-AvailableMemoryPercentage-threshold-Override_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMMemoryAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMLowMemoryAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMLowMemoryAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine Memory\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"Memory\\\" and Name == \\\"AvailableMB\\\" | extend TotalMemory = toreal(todynamic(Tags)[\\\"vm.azm.ms/memorySizeMB\\\"]) | extend AvailableMemoryPercentage = (toreal(Val) / TotalMemory) * 100.0 | summarize AggregatedValue = avg(AvailableMemoryPercentage) by bin(TimeGenerated, 15m), Computer, _ResourceId | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue < appliedThreshold | project TimeGenerated, Computer, _ResourceId, AggregatedValue, appliedThreshold', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-AvailableMemoryPercentage-threshold-Override_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#11": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_Disconnected_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM Disconnected Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM Disconnected Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.8.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"P1D\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT10M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT2H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"P1D\"\r\n        ],\r\n        \"defaultValue\": \"PT10M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"defaultValue\": \"10m\",\r\n        \"allowedValues\": [\r\n          \"5m\",\r\n          \"10m\",\r\n          \"15m\",\r\n          \"30m\",\r\n          \"1h\",\r\n          \"2h\",\r\n          \"3h\",\r\n          \"6h\",\r\n          \"12h\",\r\n          \"1d\",\r\n          \"2d\",\r\n          \"3d\",\r\n          \"7d\"\r\n        ],\r\n        \"metadata\": {\r\n          \"displayName\": \"Hybrid VM Disconnected Threshold (expressed in timespan)\",\r\n          \"description\": \"Threshold in timespan value for the Hybrid VM Disconnected alert\"\r\n        }\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMDisconnectedAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; arg(\\\"\\\").resources | where type == \\\"microsoft.hybridcompute/machines\\\" | where tostring(tags.[\\\"{1}\\\"]) !in~ (\\\"{2}\\\") | where tostring(properties.status) == \\\"Disconnected\\\" | extend lastContactedDate = todatetime(properties.lastStatusChange) | where lastContactedDate <= ago(totimespan(policyThresholdString)) | extend status = tostring(properties.status) | project id, Computer=name, status, lastContactedDate', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'))]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMDisconnectedAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMDisconnectedAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMDisconnectedAlert')]\",\r\n                              \"description\": \"Hybrid VM in disconnected state. Not being connected, prevents extensions to be correctly managed from the portal and Azure policies to be correctly applied. Ensure that both server the specific service (Azure Hybrid Instance Metadata Service on Windows or azcmagent on Linux) are running.\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; arg(\\\"\\\").resources | where type == \\\"microsoft.hybridcompute/machines\\\" | where tostring(tags.[\\\"{1}\\\"]) !in~ (\\\"{2}\\\") | where tostring(properties.status) == \\\"Disconnected\\\" | extend lastContactedDate = todatetime(properties.lastStatusChange) | where lastContactedDate <= ago(totimespan(policyThresholdString)) | extend status = tostring(properties.status) | project id, Computer=name, status, lastContactedDate', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'))]\",\r\n                                    \"resourceIdColumn\": \"id\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#12": {
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2021-06-01",
      "name": "Alerting-HybridVM",
      "properties": {
        "displayName": "Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) for Hybrid Virtual Machines",
        "description": "This initiative deploys Azure Monitor Baseline Alerts (AMBA-ALZ) to monitor Azure Arc-enabled Servers.",
        "metadata": {
          "version": "1.3.0",
          "category": "Monitoring",
          "source": "https://github.com/Azure/azure-monitor-baseline-alerts/",
          "alzCloudEnvironments": [
            "AzureCloud"
          ],
          "_deployed_by_amba": true
        },
        "parameters": {
          "ALZMonitorResourceGroupName": {
            "type": "String",
            "defaultValue": "rg-amba-monitoring-001",
            "metadata": {
              "displayName": "ALZ Monitor Resource Group Name",
              "description": "Name of the resource group where the ALZ Monitor resources will be deployed"
            }
          },
          "ALZMonitorResourceGroupTags": {
            "type": "Object",
            "defaultValue": {
              "_deployed_by_alz_monitor": true
            },
            "metadata": {
              "displayName": "ALZ Monitor Resource Group Tags",
              "description": "Tags for the resource group where the ALZ Monitor resources will be deployed"
            }
          },
          "ALZMonitorResourceGroupLocation": {
            "type": "String",
            "defaultValue": "centralus",
            "metadata": {
              "displayName": "ALZ Monitor Resource Group Location",
              "description": "Location of the resource group where the ALZ Monitor resources will be deployed"
            }
          },
          "ALZMonitorDisableTagName": {
            "type": "String",
            "metadata": {
              "displayName": "ALZ Monitoring disabled tag name",
              "description": "Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled."
            },
            "defaultValue": "MonitorDisable"
          },
          "ALZMonitorDisableTagValues": {
            "type": "Array",
            "metadata": {
              "displayName": "ALZ Monitoring disabled tag values(s)",
              "description": "Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled."
            },
            "defaultValue": [
              "true",
              "Test",
              "Dev",
              "Sandbox"
            ]
          },
          "ALZUserAssignedManagedIdentityName": {
            "type": "string",
            "defaultValue": "id-amba-prod-001",
            "metadata": {
              "description": "The name of the user assigned managed identity to be created for monitoring purpose.",
              "displayName": "Name of the user assigned managed identity to be created."
            }
          },
          "ALZManagementSubscriptionId": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
              "description": "The subscription ID of the management subscription where the user assigned managed identity will be created."
            }
          },
          "BYOUserAssignedManagedIdentityResourceId": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
              "description": "The resource Id of the user assigned managed identity provided by the customer.",
              "displayName": "Customer defined User Assigned managed Identity resource Id."
            }
          },
          "HybridVMHeartBeatRGAlertSeverity": {
            "type": "String",
            "defaultValue": "1",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Alert Severity",
              "description": "Severity of the alert for VM Heart Beat RG"
            }
          },
          "HybridVMHeartBeatRGWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMHeartBeatRGEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMHeartBeatRGAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMHeartBeatRGcheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMHeartBeatRGAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMHeartBeatRGAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMHeartBeatRGPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMHeartBeatRGAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Alert State",
              "description": "Alert state for the alert"
            }
          },
          "HybridVMHeartBeatRGThreshold": {
            "type": "string",
            "defaultValue": "10",
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMHeartBeatRGOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMHeartBeatRGTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Heart Beat RG Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMHeartBeatRGFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "HybridVM Heart Beat RG Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMNetworkInAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network In Alert Severity",
              "description": "Severity of the alert for VM Network In"
            }
          },
          "HybridVMNetworkInWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network In Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMNetworkInEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network In Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMNetworkInAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Network In Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMNetworkIncheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Network In Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMNetworkInAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Network In Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMNetworkInAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM Network In Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMNetworkInPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network In Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMNetworkInAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Network In Alert State",
              "description": "Alert state for the alert"
            }
          },
          "HybridVMNetworkInThreshold": {
            "type": "string",
            "defaultValue": "10000000",
            "metadata": {
              "displayName": "Hybrid VM Network In Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMNetworkInOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network In Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMNetworkInTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network In Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMNetworkInEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Network In Evaluation Periods",
              "description": "Evaluation Periods for the alert"
            }
          },
          "HybridVMNetworkInFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Network In Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMNetworkOutAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network Out Alert Severity",
              "description": "Severity of the alert for VM Network Out"
            }
          },
          "HybridVMNetworkOutWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network Out Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMNetworkOutEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network Out Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMNetworkOutAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Network Out Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMNetworkOutcheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Network Out Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMNetworkOutAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Network Out Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMNetworkOutAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM Network Out Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMNetworkOutPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network Out Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMNetworkOutAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Network Out Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMNetworkOutThreshold": {
            "type": "string",
            "defaultValue": "10000000",
            "metadata": {
              "displayName": "Hybrid VM Network Out Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMNetworkOutOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network Out Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMNetworkOutTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Network Out Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMNetworkOutEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Network Out Evaluation Periods",
              "description": "Evaluation Periods for the alert"
            }
          },
          "HybridVMNetworkOutFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Network Out Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Alert Severity",
              "description": "Severity of the alert for VM OS Disk Read Latency"
            }
          },
          "HybridVMOSDiskReadLatencyWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMOSDiskReadLatencycheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMOSDiskReadLatencyAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMOSDiskReadLatencyAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMOSDiskReadLatencyThreshold": {
            "type": "string",
            "defaultValue": "30",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Evaluation Periods",
              "description": "Evaluation Periods for the alert"
            }
          },
          "HybridVMOSDiskReadLatencyFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Read Latency Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Alert Severity",
              "description": "Severity of the alert for VM OS Disk Write Latency"
            }
          },
          "HybridVMOSDiskWriteLatencyWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencycheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMOSDiskWriteLatencyAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMOSDiskWriteLatencyAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyThreshold": {
            "type": "string",
            "defaultValue": "50",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Evaluation Periods",
              "description": "Evaluation Periods for the alert"
            }
          },
          "HybridVMOSDiskWriteLatencyFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Write Latency Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMOSDiskSpaceAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Alert Severity",
              "description": "Severity of the alert for VM OS Disk Space"
            }
          },
          "HybridVMOSDiskSpaceWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMOSDiskSpaceEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMOSDiskSpaceAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMOSDiskSpacecheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMOSDiskSpaceAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMOSDiskSpaceAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMOSDiskSpacePolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMOSDiskSpaceAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMOSDiskSpaceThreshold": {
            "type": "string",
            "defaultValue": "10",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMOSDiskSpaceOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMOSDiskSpaceTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMOSDiskSpaceEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Evaluation Periods",
              "description": "Evaluation Periods for the alert"
            }
          },
          "HybridVMOSDiskSpaceFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM OS Disk Space Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMPercentCPUAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Alert Severity",
              "description": "Severity of the alert for VM Percent CPU"
            }
          },
          "HybridVMPercentCPUWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMPercentCPUEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMPercentCPUAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMPercentCPUcheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMPercentCPUAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMPercentCPUAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMPercentCPUPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMPercentCPUAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMPercentCPUThreshold": {
            "type": "string",
            "defaultValue": "85",
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMPercentCPUOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMPercentCPUTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMPercentCPUFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Percent CPU Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMPercentMemoryAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Alert Severity",
              "description": "Severity of the alert for VM Percent Memory"
            }
          },
          "HybridVMPercentMemoryWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMPercentMemoryEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMPercentMemoryAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMPercentMemorycheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMPercentMemoryAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMPercentMemoryAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMPercentMemoryPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMPercentMemoryAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMPercentMemoryThreshold": {
            "type": "string",
            "defaultValue": "10",
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMPercentMemoryOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMPercentMemoryTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMPercentMemoryFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Percent Memory Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMDataDiskSpaceAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Alert Severity",
              "description": "Severity of the alert for VM Data Disk Space"
            }
          },
          "HybridVMDataDiskSpaceWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMDataDiskSpaceEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMDataDiskSpaceAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMDataDiskSpacecheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMDataDiskSpaceAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMDataDiskSpaceAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMDataDiskSpacePolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMDataDiskSpaceAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMDataDiskSpaceThreshold": {
            "type": "string",
            "defaultValue": "10",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMDataDiskSpaceOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMDataDiskSpaceTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMDataDiskSpaceEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Evaluation Periods",
              "description": "Evaluation Periods for the alert"
            }
          },
          "HybridVMDataDiskSpaceFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Space Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Alert Severity",
              "description": "Severity of the alert for VM Data Disk Read Latency"
            }
          },
          "HybridVMDataDiskReadLatencyWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMDataDiskReadLatencycheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMDataDiskReadLatencyAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMDataDiskReadLatencyAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMDataDiskReadLatencyThreshold": {
            "type": "string",
            "defaultValue": "30",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Evaluation Periods",
              "description": "Evaluation Periods for the alert"
            }
          },
          "HybridVMDataDiskReadLatencyFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Read Latency Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyAlertSeverity": {
            "type": "String",
            "defaultValue": "2",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Alert Severity",
              "description": "Severity of the alert for VM Data Disk Write Latency"
            }
          },
          "HybridVMDataDiskWriteLatencyWindowSize": {
            "type": "string",
            "defaultValue": "PT15M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Window Size",
              "description": "Window size for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT5M",
            "allowedValues": [
              "PT1M",
              "PT5M",
              "PT15M",
              "PT30M",
              "PT1H"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Evaluation Frequency",
              "description": "Evaluation frequency for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Auto Mitigate",
              "description": "Auto Mitigate for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencycheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMDataDiskWriteLatencyAutoResolve": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Auto Resolve",
              "description": "Auto Resolve for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyAutoResolveTime": {
            "type": "string",
            "defaultValue": "00:10:00",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Auto Resolve Time",
              "description": "Auto Resolve Time for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMDataDiskWriteLatencyAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyThreshold": {
            "type": "string",
            "defaultValue": "30",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Threshold",
              "description": "Threshold for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Operator",
              "description": "Operator for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Time Aggregation",
              "description": "Time Aggregation for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Evaluation Periods",
              "description": "Evaluation Periods for the alert"
            }
          },
          "HybridVMDataDiskWriteLatencyFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Data Disk Write Latency Failing Periods",
              "description": "Failing Periods for the alert"
            }
          },
          "HybridVMDisconnectedAlertSeverity": {
            "type": "String",
            "defaultValue": "1",
            "allowedValues": [
              "0",
              "1",
              "2",
              "3",
              "4"
            ],
            "metadata": {
              "displayName": "Hybrid VM Disconnected Alert Severity",
              "description": "Severity of the Hybrid VM Disconnected alert"
            }
          },
          "HybridVMDisconnectedAlertWindowSize": {
            "type": "string",
            "defaultValue": "P1D",
            "allowedValues": [
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Disconnected Window Size",
              "description": "Window size for the Hybrid VM Disconnected alert"
            }
          },
          "HybridVMDisconnectedAlertEvaluationFrequency": {
            "type": "string",
            "defaultValue": "PT10M",
            "allowedValues": [
              "PT5M",
              "PT10M",
              "PT15M",
              "PT30M",
              "PT1H",
              "PT2H",
              "PT6H",
              "PT12H",
              "P1D"
            ],
            "metadata": {
              "displayName": "Hybrid VM Disconnected Evaluation Frequency",
              "description": "Evaluation frequency for the Hybrid VM Disconnected alert"
            }
          },
          "HybridVMDisconnectedAlertAutoMitigate": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Disconnected Auto Mitigate",
              "description": "Auto Mitigate for the Hybrid VM Disconnected alert"
            }
          },
          "HybridVMDisconnectedAlertcheckWorkspaceAlertsStorageConfigured": {
            "type": "string",
            "defaultValue": "false",
            "metadata": {
              "displayName": "Hybrid VM Disconnected Require a workspace linked storage",
              "description": "Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys)."
            }
          },
          "HybridVMDisconnectedAlertPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Hybrid VM Disconnected Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "HybridVMDisconnectedAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Hybrid VM Disconnected Alert State",
              "description": "Alert state for the alert, true will enable the alert, false will disable the alert"
            }
          },
          "HybridVMDisconnectedAlertThreshold": {
            "type": "string",
            "defaultValue": "10m",
            "allowedValues": [
              "5m",
              "10m",
              "15m",
              "30m",
              "1h",
              "2h",
              "3h",
              "6h",
              "12h",
              "1d",
              "2d",
              "3d",
              "7d"
            ],
            "metadata": {
              "displayName": "Hybrid VM Disconnected Threshold (expressed in timespan)",
              "description": "Threshold in timespan value for the Hybrid VM Disconnected alert"
            }
          },
          "HybridVMDisconnectedAlertOperator": {
            "type": "string",
            "defaultValue": "GreaterThan",
            "allowedValues": [
              "GreaterThan"
            ],
            "metadata": {
              "displayName": "Hybrid VM Disconnected Operator",
              "description": "Operator for the Hybrid VM Disconnected alert"
            }
          },
          "HybridVMDisconnectedAlertTimeAggregation": {
            "type": "string",
            "defaultValue": "Count",
            "allowedValues": [
              "Count"
            ],
            "metadata": {
              "displayName": "Hybrid VM Disconnected Time Aggregation",
              "description": "Time Aggregation for the Hybrid VM Disconnected alert"
            }
          },
          "HybridVMDisconnectedAlertEvaluationPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Disconnected Evaluation Periods",
              "description": "Evaluation Periods for the Hybrid VM Disconnected alert"
            }
          },
          "HybridVMDisconnectedAlertFailingPeriods": {
            "type": "string",
            "defaultValue": "1",
            "metadata": {
              "displayName": "Hybrid VM Disconnected Failing Periods",
              "description": "Failing Periods for the Hybrid VM Disconnected alert"
            }
          }
        },
        "policyDefinitions": [
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMHeartBeatRG",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_HeartBeat_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMHeartBeatRGAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMHeartBeatRGWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMHeartBeatRGEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMHeartBeatRGAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMHeartBeatRGcheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMHeartBeatRGAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMHeartBeatRGAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMHeartBeatRGPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMHeartBeatRGAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMHeartBeatRGThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMHeartBeatRGOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMHeartBeatRGTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMHeartBeatRGFailingPeriods')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMNetworkIn",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_NetworkIn_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMNetworkInAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMNetworkInWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMNetworkInEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMNetworkInAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMNetworkIncheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMNetworkInAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMNetworkInAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMNetworkInPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMNetworkInAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMNetworkInThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMNetworkInOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMNetworkInTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMNetworkInFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMNetworkInEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMNetworkOut",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_NetworkOut_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMNetworkOutAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMNetworkOutWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMNetworkOutEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMNetworkOutAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMNetworkOutcheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMNetworkOutAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMNetworkOutAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMNetworkOutPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMNetworkOutAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMNetworkOutThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMNetworkOutOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMNetworkOutTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMNetworkOutFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMNetworkOutEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMOSDiskReadLatency",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_OSDiskreadLatency_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencycheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMOSDiskReadLatencyEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMOSDiskWriteLatency",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_OSDiskwriteLatency_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencycheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMOSDiskWriteLatencyEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMOSDiskSpace",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_OSDiskSpace_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMOSDiskSpaceAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMOSDiskSpaceWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMOSDiskSpaceEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMOSDiskSpaceAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMOSDiskSpacecheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMOSDiskSpaceAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMOSDiskSpaceAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMOSDiskSpacePolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMOSDiskSpaceAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMOSDiskSpaceThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMOSDiskSpaceOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMOSDiskSpaceTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMOSDiskSpaceFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMOSDiskSpaceEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMPercentCPU",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_CPU_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMPercentCPUAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMPercentCPUWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMPercentCPUEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMPercentCPUAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMPercentCPUcheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMPercentCPUAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMPercentCPUAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMPercentCPUPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMPercentCPUAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMPercentCPUThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMPercentCPUOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMPercentCPUTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMPercentCPUFailingPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMPercentMemory",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_Memory_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMPercentMemoryAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMPercentMemoryWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMPercentMemoryEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMPercentMemoryAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMPercentMemorycheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMPercentMemoryAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMPercentMemoryAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMPercentMemoryPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMPercentMemoryAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMPercentMemoryThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMPercentMemoryOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMPercentMemoryTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMPercentMemoryFailingPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMDataDiskSpace",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_dataDiskSpace_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMDataDiskSpaceAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMDataDiskSpaceWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMDataDiskSpaceEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMDataDiskSpaceAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMDataDiskSpacecheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMDataDiskSpaceAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMDataDiskSpaceAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMDataDiskSpacePolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMDataDiskSpaceAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMDataDiskSpaceThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMDataDiskSpaceOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMDataDiskSpaceTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMDataDiskSpaceFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMDataDiskSpaceEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMDataDiskReadLatency",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_dataDiskReadLatency_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencycheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMDataDiskReadLatencyEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMDataDiskWriteLatency",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_dataDiskWriteLatency_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencycheckWorkspaceAlertsStorageConfigured')]"
              },
              "autoResolve": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyAutoResolve')]"
              },
              "autoResolveTime": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyAutoResolveTime')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMDataDiskWriteLatencyEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_HybridVMDisconnected",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_Hybrid_VM_Disconnected_Alert",
            "parameters": {
              "UAMIResourceId": {
                "value": "[[[if(empty(parameters('BYOUserAssignedManagedIdentityResourceId')), concat('/subscriptions/', parameters('ALZManagementSubscriptionId'), '/resourceGroups/', parameters('ALZMonitorResourceGroupName'), '/providers/Microsoft.ManagedIdentity/userAssignedIdentities/', parameters('ALZUserAssignedManagedIdentityName')),parameters('BYOUserAssignedManagedIdentityResourceId'))]"
              },
              "severity": {
                "value": "[[[parameters('HybridVMDisconnectedAlertSeverity')]"
              },
              "windowSize": {
                "value": "[[[parameters('HybridVMDisconnectedAlertWindowSize')]"
              },
              "evaluationFrequency": {
                "value": "[[[parameters('HybridVMDisconnectedAlertEvaluationFrequency')]"
              },
              "autoMitigate": {
                "value": "[[[parameters('HybridVMDisconnectedAlertAutoMitigate')]"
              },
              "checkWorkspaceAlertsStorageConfigured": {
                "value": "[[[parameters('HybridVMDisconnectedAlertcheckWorkspaceAlertsStorageConfigured')]"
              },
              "effect": {
                "value": "[[[parameters('HybridVMDisconnectedAlertPolicyEffect')]"
              },
              "enabled": {
                "value": "[[[parameters('HybridVMDisconnectedAlertState')]"
              },
              "threshold": {
                "value": "[[[parameters('HybridVMDisconnectedAlertThreshold')]"
              },
              "operator": {
                "value": "[[[parameters('HybridVMDisconnectedAlertOperator')]"
              },
              "timeAggregation": {
                "value": "[[[parameters('HybridVMDisconnectedAlertTimeAggregation')]"
              },
              "failingPeriods": {
                "value": "[[[parameters('HybridVMDisconnectedAlertFailingPeriods')]"
              },
              "evaluationPeriods": {
                "value": "[[[parameters('HybridVMDisconnectedAlertEvaluationPeriods')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          }
        ],
        "policyType": "Custom",
        "policyDefinitionGroups": null
      }
    },
    "$fxv#2": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_dataDiskWriteLatency_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM Data Disk Write Latency Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM Data Disk Write Latency Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.7.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"30\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMHighDataDiskWriteLatencyAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"WriteLatencyMs\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk !in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-WriteLatencyMs-Data-threshold-Override_', '_amba-ExcludedLogicalVolumes-WriteLatency_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMdataDiskWriteLatencyAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMHighDataDiskWriteLatencyAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMHighDataDiskWriteLatencyAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine dataDiskWriteLatency\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"WriteLatencyMs\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk !in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-WriteLatencyMs-Data-threshold-Override_', '_amba-ExcludedLogicalVolumes-WriteLatency_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      },\r\n                                      {\r\n                                        \"name\": \"Disk\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#3": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_HeartBeat_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM HeartBeat Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM HeartBeat Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.6.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT6H\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"10\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMHeartBeatAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); Heartbeat | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | summarize TimeGenerated=max(TimeGenerated) by Computer, _ResourceId | extend Duration = datetime_diff(\\\"minute\\\",now(),TimeGenerated) | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where Duration > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Duration, appliedThreshold', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-Heartbeat-threshold-Override_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMHeartBeatAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMHeartBeatAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMHeartBeatAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine Heartbeat\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); Heartbeat | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | summarize TimeGenerated=max(TimeGenerated) by Computer, _ResourceId | extend Duration = datetime_diff(\\\"minute\\\",now(),TimeGenerated) | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where Duration > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Duration, appliedThreshold', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-Heartbeat-threshold-Override_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#4": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_NetworkIn_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM Network Read Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM Nework Read Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.6.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"10000000\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMHighNetworkInAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"Network\\\" and Name == \\\"ReadBytesPerSecond\\\" | extend NetworkInterface=tostring(todynamic(Tags)[\\\"vm.azm.ms/networkDeviceId\\\"]) | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, NetworkInterface | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, NetworkInterface, AggregatedValue, appliedThreshold' , parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-ReadBytesPerSecond-threshold-Override_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMVMNetworkInAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMHighNetworkInAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMHighNetworkInAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine NetworkIn\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"Network\\\" and Name == \\\"ReadBytesPerSecond\\\" | extend NetworkInterface=tostring(todynamic(Tags)[\\\"vm.azm.ms/networkDeviceId\\\"]) | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, NetworkInterface | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, NetworkInterface, AggregatedValue, appliedThreshold' , parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-ReadBytesPerSecond-threshold-Override_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      },\r\n                                      {\r\n                                        \"name\": \"NetworkInterface\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#5": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_NetworkOut_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM Network Write Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM Network Out Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.6.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"10000000\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMHighNetworkOutAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"Network\\\" and Name == \\\"WriteBytesPerSecond\\\" | extend NetworkInterface=tostring(todynamic(Tags)[\\\"vm.azm.ms/networkDeviceId\\\"]) | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, NetworkInterface | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, NetworkInterface, AggregatedValue, appliedThreshold' , parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-WriteBytesPerSecond-threshold-Override_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMVMNetworkOutAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMHighNetworkOutAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMHighNetworkOutAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine NetworkOut\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"Network\\\" and Name == \\\"WriteBytesPerSecond\\\" | extend NetworkInterface=tostring(todynamic(Tags)[\\\"vm.azm.ms/networkDeviceId\\\"]) | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, NetworkInterface | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, NetworkInterface, AggregatedValue, appliedThreshold' , parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-WriteBytesPerSecond-threshold-Override_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      },\r\n                                      {\r\n                                        \"name\": \"NetworkInterface\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#6": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_OSDiskreadLatency_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM OS Disk Read Latency Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM OS Disk Read Latency Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.7.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"30\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMHighOSDiskReadLatencyAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"ReadLatencyMs\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-ReadLatencyMs-OS-threshold-Override_', '_amba-ExcludedLogicalVolumes-ReadLatency_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMOSDiskreadLatencyAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMHighOSDiskReadLatencyAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMHighOSDiskReadLatencyAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine OSDiskreadLatency\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"ReadLatencyMs\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-ReadLatencyMs-OS-threshold-Override_', '_amba-ExcludedLogicalVolumes-ReadLatency_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      },\r\n                                      {\r\n                                        \"name\": \"Disk\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#7": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_OSDiskSpace_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM OS Disk Space Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM OS Disk Space Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.7.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"10\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMLowOSDiskSpaceAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"FreeSpacePercentage\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue < appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-FreeSpacePercentage-OS-threshold-Override_', '_amba-ExcludedLogicalVolumes-DiskSpace_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMOSDiskSpaceAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMLowOSDiskSpaceAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMLowOSDiskSpaceAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine OSDiskSpace\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"FreeSpacePercentage\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue < appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-FreeSpacePercentage-OS-threshold-Override_', '_amba-ExcludedLogicalVolumes-DiskSpace_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      },\r\n                                      {\r\n                                        \"name\": \"Disk\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#8": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_OSDiskwriteLatency_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM OS Disk Write Latency Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM OS Disk Write Latency Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.7.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"30\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMHighOSDiskWriteLatencyAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"WriteLatencyMs\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-WriteLatencyMs-OS-threshold-Override_', '_amba-ExcludedLogicalVolumes-WriteLatency_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMOSDiskwriteLatencyAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMHighOSDiskWriteLatencyAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMHighOSDiskWriteLatencyAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine OSDiskwriteLatency\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"LogicalDisk\\\" and Name == \\\"WriteLatencyMs\\\" | extend Disk=tostring(todynamic(Tags)[\\\"vm.azm.ms/mountId\\\"]) | where Disk in (\\\"C:\\\", \\\"/\\\") | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId, Disk | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend excludedLogicalVolumes = iif(isnotempty(resourceTags.[\\\"{4}\\\"]),resourceTags.[\\\"{4}\\\"], \\\"No logical volumes excluded\\\") | where excludedLogicalVolumes !has Disk | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, Disk, AggregatedValue, appliedThreshold, excludedLogicalVolumes', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-WriteLatencyMs-OS-threshold-Override_', '_amba-ExcludedLogicalVolumes-WriteLatency_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      },\r\n                                      {\r\n                                        \"name\": \"Disk\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#9": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_Hybrid_VM_CPU_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Hybrid VM CPU Alert\",\r\n    \"description\": \"Policy to audit/deploy Hybrid VM CPU Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.6.0\",\r\n      \"category\": \"Hybrid Compute\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"Project\": \"amba-monitoring\"\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"UAMIResourceId\": {\r\n        \"type\": \"string\",\r\n        \"defaultValue\": \"\",\r\n        \"metadata\": {\r\n          \"description\": \"The resource Id of the user assigned managed identity.\",\r\n          \"displayName\": \"User Assigned managed Identity resource Id.\",\r\n          \"assignPermissions\": true\r\n        }\r\n      },\r\n      \"severity\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Severity\",\r\n          \"description\": \"Severity of the Alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"0\",\r\n          \"1\",\r\n          \"2\",\r\n          \"3\",\r\n          \"4\"\r\n        ],\r\n        \"defaultValue\": \"2\"\r\n      },\r\n      \"operator\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Operator\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"GreaterThan\"\r\n        ],\r\n        \"defaultValue\": \"GreaterThan\"\r\n      },\r\n      \"timeAggregation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"TimeAggregation\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"Count\"\r\n        ],\r\n        \"defaultValue\": \"Count\"\r\n      },\r\n      \"windowSize\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Window Size\",\r\n          \"description\": \"Window size for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\",\r\n          \"PT6H\",\r\n          \"PT12H\",\r\n          \"PT24H\"\r\n        ],\r\n        \"defaultValue\": \"PT15M\"\r\n      },\r\n      \"evaluationFrequency\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Frequency\",\r\n          \"description\": \"Evaluation frequency for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"PT5M\",\r\n          \"PT15M\",\r\n          \"PT30M\",\r\n          \"PT1H\"\r\n        ],\r\n        \"defaultValue\": \"PT5M\"\r\n      },\r\n      \"autoMitigate\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Mitigate\",\r\n          \"description\": \"Auto Mitigate for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"checkWorkspaceAlertsStorageConfigured\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Require a workspace linked storage\",\r\n          \"description\": \"Don't create the alert rule if the Log Analytics workspace doesn't have a configured linked storage account (relevant if you're using Customer Managed Keys).\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"false\"\r\n      },\r\n      \"autoResolve\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"autoResolveTime\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Auto Resolve\",\r\n          \"description\": \"Auto Resolve time for the alert in ISO 8601 format\"\r\n        },\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"threshold\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Threshold\",\r\n          \"description\": \"Threshold for the alert\"\r\n        },\r\n        \"defaultValue\": \"85\"\r\n      },\r\n      \"failingPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Failing Periods\",\r\n          \"description\": \"Number of failing periods before alert is fired\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"evaluationPeriods\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Evaluation Periods\",\r\n          \"description\": \"The number of aggregated lookback points.\"\r\n        },\r\n        \"defaultValue\": \"1\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"deployIfNotExists\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.HybridCompute/machines\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\",\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/displayName\",\r\n                \"equals\": \"[[concat(subscription().displayName, '-HybridVMHighCPUAlert')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/scopes[*]\",\r\n                \"equals\": \"[[subscription().id]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/evaluationFrequency\",\r\n                \"equals\": \"[[parameters('evaluationFrequency')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/windowSize\",\r\n                \"equals\": \"[[parameters('windowSize')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/severity\",\r\n                \"equals\": \"[[parameters('severity')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/autoMitigate\",\r\n                \"equals\": \"[[parameters('autoMitigate')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/checkWorkspaceAlertsStorageConfigured\",\r\n                \"equals\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].operator\",\r\n                \"equals\": \"[[parameters('operator')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].timeAggregation\",\r\n                \"equals\": \"[[parameters('timeAggregation')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.numberOfEvaluationPeriods\",\r\n                \"equals\": \"[[parameters('evaluationPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].failingPeriods.minFailingPeriodsToAlert\",\r\n                \"equals\": \"[[parameters('failingPeriods')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/scheduledQueryRules/criteria.allOf[*].query\",\r\n                \"equals\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"Processor\\\" and Name == \\\"UtilizationPercentage\\\" | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, AggregatedValue, appliedThreshold', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-UtilizationPercentage-threshold-Override_')]\"\r\n              },\r\n              {\r\n                \"field\": \"identity.userAssignedIdentities\",\r\n                \"containsKey\": \"[[parameters('UAMIResourceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"UAMIResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"severity\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"windowSize\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationFrequency\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoMitigate\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"checkWorkspaceAlertsStorageConfigured\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolve\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"autoResolveTime\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"threshold\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"operator\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"timeAggregation\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"failingPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"evaluationPeriods\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagName\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"MonitorDisableTagValues\": {\r\n                    \"type\": \"Array\"\r\n                  }\r\n                },\r\n                \"variables\": {},\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"HybridVMCPUAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupLocation\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"UAMIResourceId\": {\r\n                            \"type\": \"string\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"Microsoft.Insights/scheduledQueryRules\",\r\n                            \"apiVersion\": \"2022-08-01-preview\",\r\n                            \"name\": \"[[concat(subscription().displayName, '-HybridVMHighCPUAlert')]\",\r\n                            \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                            \"identity\": {\r\n                              \"type\": \"UserAssigned\",\r\n                              \"userAssignedIdentities\": {\r\n                                \"[[parameters('UAMIResourceId')]\": {}\r\n                              }\r\n                            },\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"displayName\": \"[[concat(subscription().displayName, '-HybridVMHighCPUAlert')]\",\r\n                              \"description\": \"Log Alert for Virtual Machine CPU\",\r\n                              \"severity\": \"[[parameters('severity')]\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().Id]\"\r\n                              ],\r\n                              \"targetResourceTypes\": [\r\n                                \"Microsoft.HybridCompute/machines\"\r\n                              ],\r\n                              \"evaluationFrequency\": \"[[parameters('evaluationFrequency')]\",\r\n                              \"windowSize\": \"[[parameters('windowSize')]\",\r\n                              \"criteria\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"query\": \"[[format('let policyThresholdString = \\\"{0}\\\"; let resourceTagging = (arg(\\\"\\\").resources | where type =~ \\\"Microsoft.HybridCompute/machines\\\" | where tags.[\\\"{1}\\\"] !in~ (\\\"{2}\\\") | project _ResourceId = tolower(id), resourceTags = tags); InsightsMetrics | where _ResourceId has \\\"Microsoft.HybridCompute/machines\\\" | where Origin == \\\"vm.azm.ms\\\" | where Namespace == \\\"Processor\\\" and Name == \\\"UtilizationPercentage\\\" | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId | join hint.remote=left kind=inner (resourceTagging ) on _ResourceId | project-away _ResourceId1 | extend newThresholdString = tostring(resourceTags.[\\\"{3}\\\"]) | extend appliedThreshold = iif(isempty(newThresholdString), toint(policyThresholdString), toint(newThresholdString)) | where AggregatedValue > appliedThreshold | project TimeGenerated, Computer, _ResourceId, AggregatedValue, appliedThreshold', parameters('threshold'), parameters('MonitorDisableTagName'), join(parameters('MonitorDisableTagValues'), '\\\",\\\"'), '_amba-UtilizationPercentage-threshold-Override_')]\",\r\n                                    \"threshold\": 0,\r\n                                    \"operator\": \"[[parameters('operator')]\",\r\n                                    \"resourceIdColumn\": \"_ResourceId\",\r\n                                    \"timeAggregation\": \"[[parameters('timeAggregation')]\",\r\n                                    \"dimensions\": [\r\n                                      {\r\n                                        \"name\": \"Computer\",\r\n                                        \"operator\": \"Include\",\r\n                                        \"values\": [\r\n                                          \"*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"failingPeriods\": {\r\n                                      \"numberOfEvaluationPeriods\": \"[[parameters('evaluationPeriods')]\",\r\n                                      \"minFailingPeriodsToAlert\": \"[[parameters('failingPeriods')]\"\r\n                                    }\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"autoMitigate\": \"[[parameters('autoMitigate')]\",\r\n                              \"checkWorkspaceAlertsStorageConfigured\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\",\r\n                              \"ruleResolveConfiguration\": {\r\n                                \"autoResolved\": \"[[parameters('autoResolve')]\",\r\n                                \"timeToResolve\": \"[[parameters('autoResolveTime')]\"\r\n                              },\r\n                              \"parameters\": {\r\n                                \"alertResourceGroupName\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                                },\r\n                                \"alertResourceGroupLocation\": {\r\n                                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                                },\r\n                                \"UAMIResourceId\": {\r\n                                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                                },\r\n                                \"severity\": {\r\n                                  \"value\": \"[[parameters('severity')]\"\r\n                                },\r\n                                \"windowSize\": {\r\n                                  \"value\": \"[[parameters('windowSize')]\"\r\n                                },\r\n                                \"evaluationFrequency\": {\r\n                                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                                },\r\n                                \"autoMitigate\": {\r\n                                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                                },\r\n                                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                                },\r\n                                \"autoResolve\": {\r\n                                  \"value\": \"[[parameters('autoResolve')]\"\r\n                                },\r\n                                \"autoResolveTime\": {\r\n                                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                                },\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                },\r\n                                \"threshold\": {\r\n                                  \"value\": \"[[parameters('threshold')]\"\r\n                                },\r\n                                \"failingPeriods\": {\r\n                                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                                },\r\n                                \"evaluationPeriods\": {\r\n                                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                                },\r\n                                \"MonitorDisableTagName\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                                },\r\n                                \"MonitorDisableTagValues\": {\r\n                                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"alertResourceGroupLocation\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                        },\r\n                        \"UAMIResourceId\": {\r\n                          \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"UAMIResourceId\": {\r\n                  \"value\": \"[[parameters('UAMIResourceId')]\"\r\n                },\r\n                \"severity\": {\r\n                  \"value\": \"[[parameters('severity')]\"\r\n                },\r\n                \"windowSize\": {\r\n                  \"value\": \"[[parameters('windowSize')]\"\r\n                },\r\n                \"evaluationFrequency\": {\r\n                  \"value\": \"[[parameters('evaluationFrequency')]\"\r\n                },\r\n                \"autoMitigate\": {\r\n                  \"value\": \"[[parameters('autoMitigate')]\"\r\n                },\r\n                \"checkWorkspaceAlertsStorageConfigured\": {\r\n                  \"value\": \"[[parameters('checkWorkspaceAlertsStorageConfigured')]\"\r\n                },\r\n                \"autoResolve\": {\r\n                  \"value\": \"[[parameters('autoResolve')]\"\r\n                },\r\n                \"autoResolveTime\": {\r\n                  \"value\": \"[[parameters('autoResolveTime')]\"\r\n                },\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"threshold\": {\r\n                  \"value\": \"[[parameters('threshold')]\"\r\n                },\r\n                \"operator\": {\r\n                  \"value\": \"[[parameters('operator')]\"\r\n                },\r\n                \"timeAggregation\": {\r\n                  \"value\": \"[[parameters('timeAggregation')]\"\r\n                },\r\n                \"failingPeriods\": {\r\n                  \"value\": \"[[parameters('failingPeriods')]\"\r\n                },\r\n                \"evaluationPeriods\": {\r\n                  \"value\": \"[[parameters('evaluationPeriods')]\"\r\n                },\r\n                \"MonitorDisableTagName\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagName')]\"\r\n                },\r\n                \"MonitorDisableTagValues\": {\r\n                  \"value\": \"[[parameters('MonitorDisableTagValues')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "cloudEnv": "[environment().name]",
    "defaultDeploymentLocationByCloudType": {
      "AzureCloud": "northeurope",
      "AzureChinaCloud": "chinaeast2",
      "AzureUSGovernment": "usgovvirginia"
    },
    "templateVars": {
      "scope": "/providers/Microsoft.Management/managementGroups/contoso",
      "defaultDeploymentLocation": "\"location\": \"northeurope\"",
      "localizedDeploymentLocation": "[format('\"location\": \"{0}\"', variables('defaultDeploymentLocationByCloudType')[variables('cloudEnv')])]"
    },
    "targetDeploymentLocationByCloudType": {
      "AzureCloud": "[coalesce(parameters('location'), 'northeurope')]",
      "AzureChinaCloud": "[coalesce(parameters('location'), 'chinaeast2')]",
      "AzureUSGovernment": "[coalesce(parameters('location'), 'usgovvirginia')]"
    },
    "deploymentLocation": "[format('\"location\": \"{0}\"', variables('targetDeploymentLocationByCloudType')[variables('cloudEnv')])]",
    "loadPolicyDefinitions": {
      "All": [
        "[variables('$fxv#0')]",
        "[variables('$fxv#1')]",
        "[variables('$fxv#2')]",
        "[variables('$fxv#3')]",
        "[variables('$fxv#4')]",
        "[variables('$fxv#5')]",
        "[variables('$fxv#6')]",
        "[variables('$fxv#7')]",
        "[variables('$fxv#8')]",
        "[variables('$fxv#9')]",
        "[variables('$fxv#10')]",
        "[variables('$fxv#11')]"
      ],
      "AzureCloud": [],
      "AzureChinaCloud": [],
      "AzureUSGovernment": []
    },
    "loadPolicySetDefinitions": {
      "All": [
        "[string(variables('$fxv#12'))]"
      ],
      "AzureCloud": [],
      "AzureChinaCloud": [],
      "AzureUSGovernment": []
    },
    "policyDefinitionsByCloudType": {
      "All": "[variables('policyDefinitionsAll')]",
      "AzureCloud": "[variables('policyDefinitionsAzureCloud')]",
      "AzureChinaCloud": "[variables('policyDefinitionsAzureChinaCloud')]",
      "AzureUSGovernment": "[variables('policyDefinitionsAzureUSGovernment')]"
    },
    "policySetDefinitionsByCloudType": {
      "All": "[variables('policySetDefinitionsAll')]",
      "AzureCloud": "[variables('policySetDefinitionsAzureCloud')]",
      "AzureChinaCloud": "[variables('policySetDefinitionsAzureChinaCloud')]",
      "AzureUSGovernment": "[variables('policySetDefinitionsAzureUSGovernment')]"
    },
    "policyDefinitions": "[concat(variables('policyDefinitionsByCloudType').All, variables('policyDefinitionsByCloudType')[variables('cloudEnv')])]",
    "policySetDefinitions": "[concat(variables('policySetDefinitionsByCloudType').All, variables('policySetDefinitionsByCloudType')[variables('cloudEnv')])]"
  },
  "resources": [
    {
      "copy": {
        "name": "PolicyDefinitions",
        "count": "[length(variables('policyDefinitions'))]"
      },
      "type": "Microsoft.Authorization/policyDefinitions",
      "apiVersion": "2020-09-01",
      "name": "[variables('policyDefinitions')[copyIndex()].name]",
      "properties": {
        "description": "[variables('policyDefinitions')[copyIndex()].properties.description]",
        "displayName": "[variables('policyDefinitions')[copyIndex()].properties.displayName]",
        "metadata": "[variables('policyDefinitions')[copyIndex()].properties.metadata]",
        "mode": "[variables('policyDefinitions')[copyIndex()].properties.mode]",
        "parameters": "[variables('policyDefinitions')[copyIndex()].properties.parameters]",
        "policyType": "[variables('policyDefinitions')[copyIndex()].properties.policyType]",
        "policyRule": "[variables('policyDefinitions')[copyIndex()].properties.policyRule]"
      }
    },
    {
      "copy": {
        "name": "PolicySetDefinitions",
        "count": "[length(variables('policySetDefinitions'))]"
      },
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2020-09-01",
      "name": "[variables('policySetDefinitions')[copyIndex()].name]",
      "properties": {
        "description": "[variables('policySetDefinitions')[copyIndex()].properties.description]",
        "displayName": "[variables('policySetDefinitions')[copyIndex()].properties.displayName]",
        "metadata": "[variables('policySetDefinitions')[copyIndex()].properties.metadata]",
        "parameters": "[variables('policySetDefinitions')[copyIndex()].properties.parameters]",
        "policyType": "[variables('policySetDefinitions')[copyIndex()].properties.policyType]",
        "policyDefinitions": "[variables('policySetDefinitions')[copyIndex()].properties.policyDefinitions]",
        "policyDefinitionGroups": "[variables('policySetDefinitions')[copyIndex()].properties.policyDefinitionGroups]"
      },
      "dependsOn": [
        "PolicyDefinitions"
      ]
    }
  ],
  "outputs": {
    "policyDefinitionNames": {
      "type": "array",
      "copy": {
        "count": "[length(variables('policyDefinitions'))]",
        "input": "[variables('policyDefinitions')[copyIndex()].name]"
      }
    },
    "policySetDefinitionNames": {
      "type": "array",
      "copy": {
        "count": "[length(variables('policySetDefinitions'))]",
        "input": "[variables('policySetDefinitions')[copyIndex()].name]"
      }
    }
  }
}