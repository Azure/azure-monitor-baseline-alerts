{
  "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.34.44.8038",
      "templateHash": "11755442589475984739"
    }
  },
  "parameters": {
    "topLevelManagementGroupPrefix": {
      "type": "string",
      "defaultValue": "alz",
      "metadata": {
        "message": "The JSON version of this file is programatically generated from Bicep. PLEASE DO NOT UPDATE MANUALLY!!",
        "description": "Provide a prefix (unique at tenant-scope) for the Management Group hierarchy and other resources created as part of an Azure landing zone. DEFAULT VALUE = \"alz\""
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[deployment().location]",
      "metadata": {
        "description": "Optionally set the deployment location for policies with Deploy If Not Exists effect. DEFAULT VALUE = \"deployment().location\""
      }
    },
    "scope": {
      "type": "string",
      "defaultValue": "[tenantResourceId('Microsoft.Management/managementGroups', parameters('topLevelManagementGroupPrefix'))]",
      "metadata": {
        "description": "Optionally set the scope for custom Policy Definitions used in Policy Set Definitions (Initiatives). Must be one of '/', '/subscriptions/id' or '/providers/Microsoft.Management/managementGroups/id'. DEFAULT VALUE = '/providers/Microsoft.Management/managementGroups/${topLevelManagementGroupPrefix}'"
      }
    }
  },
  "variables": {
    "copy": [
      {
        "name": "processPolicyDefinitionsAll",
        "count": "[length(variables('loadPolicyDefinitions').All)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').All[copyIndex('processPolicyDefinitionsAll')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureCloud",
        "count": "[length(variables('loadPolicyDefinitions').AzureCloud)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureCloud[copyIndex('processPolicyDefinitionsAzureCloud')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureChinaCloud",
        "count": "[length(variables('loadPolicyDefinitions').AzureChinaCloud)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureChinaCloud[copyIndex('processPolicyDefinitionsAzureChinaCloud')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicyDefinitionsAzureUSGovernment",
        "count": "[length(variables('loadPolicyDefinitions').AzureUSGovernment)]",
        "input": "[replace(replace(variables('loadPolicyDefinitions').AzureUSGovernment[copyIndex('processPolicyDefinitionsAzureUSGovernment')], variables('templateVars').defaultDeploymentLocation, variables('deploymentLocation')), variables('templateVars').localizedDeploymentLocation, variables('deploymentLocation'))]"
      },
      {
        "name": "processPolicySetDefinitionsAll",
        "count": "[length(variables('loadPolicySetDefinitions').All)]",
        "input": "[replace(variables('loadPolicySetDefinitions').All[copyIndex('processPolicySetDefinitionsAll')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureCloud",
        "count": "[length(variables('loadPolicySetDefinitions').AzureCloud)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureCloud[copyIndex('processPolicySetDefinitionsAzureCloud')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureChinaCloud",
        "count": "[length(variables('loadPolicySetDefinitions').AzureChinaCloud)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureChinaCloud[copyIndex('processPolicySetDefinitionsAzureChinaCloud')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "processPolicySetDefinitionsAzureUSGovernment",
        "count": "[length(variables('loadPolicySetDefinitions').AzureUSGovernment)]",
        "input": "[replace(variables('loadPolicySetDefinitions').AzureUSGovernment[copyIndex('processPolicySetDefinitionsAzureUSGovernment')], variables('templateVars').scope, parameters('scope'))]"
      },
      {
        "name": "policyDefinitionsAll",
        "count": "[length(variables('processPolicyDefinitionsAll'))]",
        "input": "[json(variables('processPolicyDefinitionsAll')[copyIndex('policyDefinitionsAll')])]"
      },
      {
        "name": "policyDefinitionsAzureCloud",
        "count": "[length(variables('processPolicyDefinitionsAzureCloud'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureCloud')[copyIndex('policyDefinitionsAzureCloud')])]"
      },
      {
        "name": "policyDefinitionsAzureChinaCloud",
        "count": "[length(variables('processPolicyDefinitionsAzureChinaCloud'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureChinaCloud')[copyIndex('policyDefinitionsAzureChinaCloud')])]"
      },
      {
        "name": "policyDefinitionsAzureUSGovernment",
        "count": "[length(variables('processPolicyDefinitionsAzureUSGovernment'))]",
        "input": "[json(variables('processPolicyDefinitionsAzureUSGovernment')[copyIndex('policyDefinitionsAzureUSGovernment')])]"
      },
      {
        "name": "policySetDefinitionsAll",
        "count": "[length(variables('processPolicySetDefinitionsAll'))]",
        "input": "[json(variables('processPolicySetDefinitionsAll')[copyIndex('policySetDefinitionsAll')])]"
      },
      {
        "name": "policySetDefinitionsAzureCloud",
        "count": "[length(variables('processPolicySetDefinitionsAzureCloud'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureCloud')[copyIndex('policySetDefinitionsAzureCloud')])]"
      },
      {
        "name": "policySetDefinitionsAzureChinaCloud",
        "count": "[length(variables('processPolicySetDefinitionsAzureChinaCloud'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureChinaCloud')[copyIndex('policySetDefinitionsAzureChinaCloud')])]"
      },
      {
        "name": "policySetDefinitionsAzureUSGovernment",
        "count": "[length(variables('processPolicySetDefinitionsAzureUSGovernment'))]",
        "input": "[json(variables('processPolicySetDefinitionsAzureUSGovernment')[copyIndex('policySetDefinitionsAzureUSGovernment')])]"
      }
    ],
    "$fxv#0": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_ServiceHealth_ActionGroups\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Service Health Action Group\",\r\n    \"description\": \"Policy to audit/deploy action group for Service Health alerts\",\r\n    \"metadata\": {\r\n      \"version\": \"1.5.0\",\r\n      \"category\": \"Monitoring\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      },\r\n      \"ALZMonitorResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"ALZMonitorResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"_deployed_by_amba\": true\r\n        }\r\n      },\r\n      \"ALZMonitorResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"ALZMonitorActionGroupEmail\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Action Group Email Addresses\",\r\n          \"description\": \"Email addresses to send alerts to\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"ALZLogicappResourceId\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Logic App Resource Id\",\r\n          \"description\": \"Logic App Resource Id for Action Group to send alerts to\"\r\n        },\r\n        \"defaultValue\": \"\"\r\n      },\r\n      \"ALZLogicappCallbackUrl\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Logic App Callback URL\",\r\n          \"description\": \"Callback URL that triggers the Logic App\"\r\n        },\r\n        \"defaultValue\": \"\"\r\n      },\r\n      \"ALZArmRoleId\": {\r\n        \"type\": \"array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Arm Role Ids\",\r\n          \"description\": \"Arm Built-in Role Ids for action group to send alerts to\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"ALZEventHubResourceId\": {\r\n        \"type\": \"array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Event Hub resource Ids\",\r\n          \"description\": \"Event Hub resource Ids for action group to send alerts to\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"ALZWebhookServiceUri\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Webhook Service Uri(s)\",\r\n          \"description\": \"Indicates the service uri(s) of the webhook to send alerts to\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"ALZFunctionResourceId\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Function Resource Id\",\r\n          \"description\": \"Function Resource Id for Action Group to send alerts to\"\r\n        },\r\n        \"defaultValue\": \"\"\r\n      },\r\n      \"ALZFunctionTriggerUrl\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Function Trigger URL\",\r\n          \"description\": \"URL that triggers the Function\"\r\n        },\r\n        \"defaultValue\": \"\"\r\n      },\r\n      \"BYOActionGroup\": {\r\n        \"type\": \"array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Customer defined Action Group Resource IDs\",\r\n          \"description\": \"The Resource IDs of existing Action Groups currently deployed in the environment.\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"BYOAlertProcessingRule\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Customer defined Alert Processing Rule Resource ID\",\r\n          \"description\": \"The Resource ID of an existing Alert Processing Rule already deployed by the customer in his environment\"\r\n        },\r\n        \"defaultValue\": \"\"\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          },\r\n          {\r\n            \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n            \"equals\": \"true\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"deployIfNotExists\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/actionGroups\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('ALZMonitorResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                \"equals\": true\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Insights/actionGroups/groupShortName\",\r\n                \"equals\": \"SH-ActGrp\"\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"ALZMonitorResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"ALZMonitorResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"ALZMonitorResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"ALZMonitorActionGroupEmail\": {\r\n                    \"type\": \"Array\"\r\n                  },\r\n                  \"ALZLogicappResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"ALZLogicappCallbackUrl\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"ALZArmRoleId\": {\r\n                    \"type\": \"array\"\r\n                  },\r\n                  \"ALZEventHubResourceId\": {\r\n                    \"type\": \"array\"\r\n                  },\r\n                  \"ALZWebhookServiceUri\": {\r\n                    \"type\": \"Array\"\r\n                  },\r\n                  \"ALZFunctionResourceId\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"ALZFunctionTriggerUrl\": {\r\n                    \"type\": \"String\"\r\n                  },\r\n                  \"BYOActionGroup\": {\r\n                    \"type\": \"array\"\r\n                  },\r\n                  \"BYOAlertProcessingRule\": {\r\n                    \"type\": \"String\"\r\n                  }\r\n                },\r\n                \"variables\": {\r\n                  \"varLogicAppReceivers\": [\r\n                    {\r\n                      \"name\": \"AlzLA-0\",\r\n                      \"resourceId\": \"[[if(empty(parameters('ALZLogicappResourceId')), null(), trim(parameters('ALZLogicappResourceId')))]\",\r\n                      \"callbackUrl\": \"[[if(empty(parameters('ALZLogicappCallbackUrl')), null(), trim(parameters('ALZLogicappCallbackUrl')))]\",\r\n                      \"useCommonAlertSchema\": true\r\n                    }\r\n                  ],\r\n                  \"varAzureFunctionReceivers\": [\r\n                    {\r\n                      \"name\": \"AlzFa-0\",\r\n                      \"functionAppResourceId\": \"[[if(empty(parameters('ALZFunctionResourceId')), null(), split(trim(parameters('ALZFunctionResourceId')),'/functions/')[0])]\",\r\n                      \"functionName\": \"[[if(empty(parameters('ALZFunctionResourceId')), null(), split(trim(parameters('ALZFunctionResourceId')),'/')[10])]\",\r\n                      \"httpTriggerUrl\": \"[[if(empty(parameters('ALZFunctionTriggerUrl')), null(), trim(parameters('ALZFunctionTriggerUrl')))]\",\r\n                      \"useCommonAlertSchema\": true\r\n                    }\r\n                  ],\r\n                  \"copy\": [\r\n                    {\r\n                      \"name\": \"varEmailReceivers\",\r\n                      \"count\": \"[[length(parameters('ALZMonitorActionGroupEmail'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"name\": \"[[concat('AlzMail-', indexOf(parameters('ALZMonitorActionGroupEmail'), parameters('ALZMonitorActionGroupEmail')[copyIndex('varEmailReceivers')]))]\",\r\n                        \"emailAddress\": \"[[trim(parameters('ALZMonitorActionGroupEmail')[copyIndex('varEmailReceivers')])]\",\r\n                        \"useCommonAlertSchema\": true\r\n                      }\r\n                    },\r\n                    {\r\n                      \"name\": \"varArmRoleReceivers\",\r\n                      \"count\": \"[[length(parameters('ALZArmRoleId'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"name\": \"[[concat('AlzARM-', indexOf(parameters('ALZArmRoleId'), parameters('ALZArmRoleId')[copyIndex('varArmRoleReceivers')]))]\",\r\n                        \"roleId\": \"[[trim(parameters('ALZArmRoleId')[copyIndex('varArmRoleReceivers')])]\",\r\n                        \"useCommonAlertSchema\": true\r\n                      }\r\n                    },\r\n                    {\r\n                      \"name\": \"varEventHubReceivers\",\r\n                      \"count\": \"[[length(parameters('ALZEventHubResourceId'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"name\": \"[[concat('AlzEH-', indexOf(parameters('ALZEventHubResourceId'), parameters('ALZEventHubResourceId')[copyIndex('varEventHubReceivers')]))]\",\r\n                        \"subscriptionId\": \"[[if(empty(parameters('ALZEventHubResourceId')), null(), split(trim(parameters('ALZEventHubResourceId')[copyIndex('varEventHubReceivers')]),'/')[2])]\",\r\n                        \"eventHubNameSpace\": \"[[if(empty(parameters('ALZEventHubResourceId')), null(), split(trim(parameters('ALZEventHubResourceId')[copyIndex('varEventHubReceivers')]),'/')[8])]\",\r\n                        \"eventHubName\": \"[[if(empty(parameters('ALZEventHubResourceId')), null(), split(trim(parameters('ALZEventHubResourceId')[copyIndex('varEventHubReceivers')]),'/')[10])]\",\r\n                        \"useCommonAlertSchema\": true,\r\n                        \"tenantId\": \"[[subscription().tenantId]\"\r\n                      }\r\n                    },\r\n                    {\r\n                      \"name\": \"varWebhookReceivers\",\r\n                      \"count\": \"[[length(parameters('ALZWebhookServiceUri'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"name\": \"[[concat('AlzWh-', indexOf(parameters('ALZWebhookServiceUri'), parameters('ALZWebhookServiceUri')[copyIndex('varWebhookReceivers')]))]\",\r\n                        \"identifierUri\": \"null()\",\r\n                        \"objectId\": \"null()\",\r\n                        \"serviceUri\": \"[[trim(parameters('ALZWebhookServiceUri')[copyIndex('varWebhookReceivers')])]\",\r\n                        \"useCommonAlertSchema\": true,\r\n                        \"tenantId\": \"null()\",\r\n                        \"useAadAuth\": \"false\"\r\n                      }\r\n                    }\r\n                  ]\r\n                },\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('ALZMonitorResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('ALZMonitorResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('ALZMonitorResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"SH-ActionGroupDeployment\",\r\n                    \"resourceGroup\": \"[[parameters('ALZMonitorResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[concat('Microsoft.Resources/resourceGroups/', parameters('ALZMonitorResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"ALZMonitorResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"ALZMonitorActionGroupEmail\": {\r\n                            \"type\": \"Array\"\r\n                          },\r\n                          \"ALZLogicappResourceId\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"ALZLogicappCallbackUrl\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"ALZArmRoleId\": {\r\n                            \"type\": \"array\"\r\n                          },\r\n                          \"ALZEventHubResourceId\": {\r\n                            \"type\": \"array\"\r\n                          },\r\n                          \"ALZWebhookServiceUri\": {\r\n                            \"type\": \"Array\"\r\n                          },\r\n                          \"ALZFunctionResourceId\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"ALZFunctionTriggerUrl\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"BYOActionGroup\": {\r\n                            \"type\": \"array\"\r\n                          },\r\n                          \"BYOAlertProcessingRule\": {\r\n                            \"type\": \"String\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"condition\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                            \"type\": \"Microsoft.Insights/actionGroups\",\r\n                            \"apiVersion\": \"2023-01-01\",\r\n                            \"name\": \"[[concat('ag-AMBA-SH-', subscription().displayName, '-001')]\",\r\n                            \"location\": \"Global\",\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"groupShortName\": \"SH-ActGrp\",\r\n                              \"enabled\": true,\r\n                              \"emailReceivers\": \"[[if(empty(parameters('ALZMonitorActionGroupEmail')), null(), variables('varEmailReceivers'))]\",\r\n                              \"armRoleReceivers\": \"[[if(empty(parameters('ALZArmRoleId')), null(), variables('varArmRoleReceivers'))]\",\r\n                              \"logicAppReceivers\": \"[[if(empty(parameters('ALZLogicappResourceId')), null(), variables('varLogicAppReceivers'))]\",\r\n                              \"eventHubReceivers\": \"[[if(empty(parameters('ALZEventHubResourceId')), null(), variables('varEventHubReceivers'))]\",\r\n                              \"webhookReceivers\": \"[[if(empty(parameters('ALZWebhookServiceUri')), null(), variables('varWebhookReceivers'))]\",\r\n                              \"azureFunctionReceivers\": \"[[if(empty(parameters('ALZFunctionResourceId')), null(), variables('varAzureFunctionReceivers'))]\"\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"ALZMonitorResourceGroupName\": {\r\n                          \"value\": \"[[parameters('ALZMonitorResourceGroupName')]\"\r\n                        },\r\n                        \"ALZMonitorActionGroupEmail\": {\r\n                          \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                        },\r\n                        \"ALZLogicappResourceId\": {\r\n                          \"value\": \"[[parameters('ALZLogicappResourceId')]\"\r\n                        },\r\n                        \"ALZLogicappCallbackUrl\": {\r\n                          \"value\": \"[[parameters('ALZLogicappCallbackUrl')]\"\r\n                        },\r\n                        \"ALZArmRoleId\": {\r\n                          \"value\": \"[[parameters('ALZArmRoleId')]\"\r\n                        },\r\n                        \"ALZEventHubResourceId\": {\r\n                          \"value\": \"[[parameters('ALZEventHubResourceId')]\"\r\n                        },\r\n                        \"ALZWebhookServiceUri\": {\r\n                          \"value\": \"[[parameters('ALZWebhookServiceUri')]\"\r\n                        },\r\n                        \"ALZFunctionResourceId\": {\r\n                          \"value\": \"[[parameters('ALZFunctionResourceId')]\"\r\n                        },\r\n                        \"ALZFunctionTriggerUrl\": {\r\n                          \"value\": \"[[parameters('ALZFunctionTriggerUrl')]\"\r\n                        },\r\n                        \"BYOActionGroup\": {\r\n                          \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                        },\r\n                        \"BYOAlertProcessingRule\": {\r\n                          \"value\": \"[[parameters('BYOAlertProcessingRule')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"ALZMonitorResourceGroupName\": {\r\n                  \"value\": \"[[parameters('ALZMonitorResourceGroupName')]\"\r\n                },\r\n                \"ALZMonitorResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('ALZMonitorResourceGroupTags')]\"\r\n                },\r\n                \"ALZMonitorResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('ALZMonitorResourceGroupLocation')]\"\r\n                },\r\n                \"ALZMonitorActionGroupEmail\": {\r\n                  \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                },\r\n                \"ALZLogicappResourceId\": {\r\n                  \"value\": \"[[parameters('ALZLogicappResourceId')]\"\r\n                },\r\n                \"ALZLogicappCallbackUrl\": {\r\n                  \"value\": \"[[parameters('ALZLogicappCallbackUrl')]\"\r\n                },\r\n                \"ALZArmRoleId\": {\r\n                  \"value\": \"[[parameters('ALZArmRoleId')]\"\r\n                },\r\n                \"ALZEventHubResourceId\": {\r\n                  \"value\": \"[[parameters('ALZEventHubResourceId')]\"\r\n                },\r\n                \"ALZWebhookServiceUri\": {\r\n                  \"value\": \"[[parameters('ALZWebhookServiceUri')]\"\r\n                },\r\n                \"ALZFunctionResourceId\": {\r\n                  \"value\": \"[[parameters('ALZFunctionResourceId')]\"\r\n                },\r\n                \"ALZFunctionTriggerUrl\": {\r\n                  \"value\": \"[[parameters('ALZFunctionTriggerUrl')]\"\r\n                },\r\n                \"BYOActionGroup\": {\r\n                  \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                },\r\n                \"BYOAlertProcessingRule\": {\r\n                  \"value\": \"[[parameters('BYOAlertProcessingRule')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#1": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_activitylog_ResourceHealth_Unhealthy_Alert\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Resource Health Unhealthy Alert\",\r\n    \"description\": \"Policy to audit/deploy Resource Health Unhealthy Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.4.0\",\r\n      \"category\": \"Monitoring\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"_deployed_by_amba\": true\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"disabled\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      },\r\n      \"BYOActionGroup\": {\r\n        \"type\": \"array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Customer defined Action Group Resource IDs\",\r\n          \"description\": \"The Resource IDs of existing Action Groups currently deployed in the environment.\"\r\n        },\r\n        \"defaultValue\": []\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/activityLogAlerts\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/ActivityLogAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": true\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                        \"contains\": \"ag-AMBA-SH-\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": false\r\n                      },\r\n                      {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*]\",\r\n                          \"where\": {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                                \"in\": \"[[parameters('BYOActionGroup')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"greaterOrEquals\": 1\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"category\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"ResourceHealth\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"equals\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"BYOActionGroup\": {\r\n                    \"type\": \"array\"\r\n                  }\r\n                },\r\n                \"variables\": {\r\n                  \"copy\": [\r\n                    {\r\n                      \"name\": \"varActionGroupIds\",\r\n                      \"count\": \"[[length(parameters('BYOActionGroup'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"actionGroupId\": \"[[trim(parameters('BYOActionGroup')[copyIndex('varActionGroupIds')])]\"\r\n                      }\r\n                    }\r\n                  ]\r\n                },\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"ResourceHealthAlert\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[resourceId('Microsoft.Resources/resourceGroups', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"BYOActionGroup\": {\r\n                            \"type\": \"array\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"microsoft.insights/activityLogAlerts\",\r\n                            \"apiVersion\": \"2020-10-01\",\r\n                            \"name\": \"ResourceHealthUnhealthyAlert\",\r\n                            \"location\": \"global\",\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"actions\": {\r\n                                \"actionGroups\": \"[[if(empty(parameters('BYOActionGroup')), array(createObject('actionGroupId', concat(subscription().Id, '/resourceGroups/', parameters('alertResourceGroupName'), '/providers/microsoft.insights/actionGroups/', 'ag-AMBA-SH-', subscription().displayName, '-001'))), variables('varActionGroupIds'))]\"\r\n                              },\r\n                              \"description\": \"Resource Health Unhealthy Alert\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().id]\"\r\n                              ],\r\n                              \"condition\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"category\",\r\n                                    \"equals\": \"ResourceHealth\"\r\n                                  },\r\n                                  {\r\n                                    \"anyOf\": [\r\n                                      {\r\n                                        \"field\": \"properties.cause\",\r\n                                        \"equals\": \"PlatformInitiated\"\r\n                                      },\r\n                                      {\r\n                                        \"field\": \"properties.cause\",\r\n                                        \"equals\": \"UserInitiated\"\r\n                                      }\r\n                                    ]\r\n                                  },\r\n                                  {\r\n                                    \"anyOf\": [\r\n                                      {\r\n                                        \"field\": \"properties.currentHealthStatus\",\r\n                                        \"equals\": \"Degraded\"\r\n                                      },\r\n                                      {\r\n                                        \"field\": \"properties.currentHealthStatus\",\r\n                                        \"equals\": \"Unavailable\"\r\n                                      }\r\n                                    ]\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"parameters\": {\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"BYOActionGroup\": {\r\n                          \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"BYOActionGroup\": {\r\n                  \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#2": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_activitylog_ServiceHealth_HealthAdvisory\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Service Health Advisory Alert\",\r\n    \"description\": \"Policy to audit/deploy Service Health Advisory Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.5.0\",\r\n      \"category\": \"Monitoring\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"_deployed_by_amba\": true\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"disabled\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      },\r\n      \"ALZMonitorActionGroupEmail\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Action Group Email Addresses\",\r\n          \"description\": \"Email addresses to send alerts to\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"BYOActionGroup\": {\r\n        \"type\": \"array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Customer defined Action Group Resource IDs\",\r\n          \"description\": \"The Resource IDs of existing Action Groups currently deployed in the environment.\"\r\n        },\r\n        \"defaultValue\": []\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/activityLogAlerts\",\r\n          \"existenceScope\": \"resourceGroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/ActivityLogAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": true\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                        \"contains\": \"ag-AMBA-SH-\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": false\r\n                      },\r\n                      {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*]\",\r\n                          \"where\": {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                                \"in\": \"[[parameters('BYOActionGroup')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"greaterOrEquals\": 1\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"category\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"ServiceHealth\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"properties.incidentType\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"ActionRequired\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"equals\": 2\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"ALZMonitorActionGroupEmail\": {\r\n                    \"type\": \"Array\"\r\n                  },\r\n                  \"BYOActionGroup\": {\r\n                    \"type\": \"array\"\r\n                  }\r\n                },\r\n                \"variables\": {\r\n                  \"copy\": [\r\n                    {\r\n                      \"name\": \"varActionGroupIds\",\r\n                      \"count\": \"[[length(parameters('BYOActionGroup'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"actionGroupId\": \"[[trim(parameters('BYOActionGroup')[copyIndex('varActionGroupIds')])]\"\r\n                      }\r\n                    }\r\n                  ]\r\n                },\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"ServiceHealthHealth\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[resourceId('Microsoft.Resources/resourceGroups', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"ALZMonitorActionGroupEmail\": {\r\n                            \"type\": \"Array\"\r\n                          },\r\n                          \"BYOActionGroup\": {\r\n                            \"type\": \"array\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"microsoft.insights/activityLogAlerts\",\r\n                            \"apiVersion\": \"2020-10-01\",\r\n                            \"name\": \"ServiceHealthAdvisoryEvent\",\r\n                            \"location\": \"Global\",\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"actions\": {\r\n                                \"actionGroups\": \"[[if(empty(parameters('BYOActionGroup')), array(createObject('actionGroupId', concat(subscription().Id, '/resourceGroups/', parameters('alertResourceGroupName'), '/providers/microsoft.insights/actionGroups/', 'ag-AMBA-SH-', subscription().displayName, '-001'))), variables('varActionGroupIds'))]\"\r\n                              },\r\n                              \"description\": \"Service Health Advisory Alert\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().id]\"\r\n                              ],\r\n                              \"condition\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"category\",\r\n                                    \"equals\": \"ServiceHealth\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"properties.incidentType\",\r\n                                    \"equals\": \"ActionRequired\"\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"parameters\": {\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"ALZMonitorActionGroupEmail\": {\r\n                          \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                        },\r\n                        \"BYOActionGroup\": {\r\n                          \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"ALZMonitorActionGroupEmail\": {\r\n                  \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                },\r\n                \"BYOActionGroup\": {\r\n                  \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#3": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_activitylog_ServiceHealth_Incident\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Service Health Incident Alert\",\r\n    \"description\": \"Policy to audit/deploy Service Health Incident Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.5.0\",\r\n      \"category\": \"Monitoring\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"_deployed_by_amba\": true\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"disabled\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      },\r\n      \"ALZMonitorActionGroupEmail\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Action Group Email Addresses\",\r\n          \"description\": \"Email addresses to send alerts to\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"BYOActionGroup\": {\r\n        \"type\": \"array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Customer defined Action Group Resource IDs\",\r\n          \"description\": \"The Resource IDs of existing Action Groups currently deployed in the environment.\"\r\n        },\r\n        \"defaultValue\": []\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/activityLogAlerts\",\r\n          \"existenceScope\": \"resourcegroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/ActivityLogAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": true\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                        \"contains\": \"ag-AMBA-SH-\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": false\r\n                      },\r\n                      {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*]\",\r\n                          \"where\": {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                                \"in\": \"[[parameters('BYOActionGroup')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"greaterOrEquals\": 1\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"category\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"ServiceHealth\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"microsoft.insights/activityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"properties.incidentType\"\r\n                          },\r\n                          {\r\n                            \"field\": \"microsoft.insights/activityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"Incident\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"equals\": 2\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"ALZMonitorActionGroupEmail\": {\r\n                    \"type\": \"Array\"\r\n                  },\r\n                  \"BYOActionGroup\": {\r\n                    \"type\": \"array\"\r\n                  }\r\n                },\r\n                \"variables\": {\r\n                  \"copy\": [\r\n                    {\r\n                      \"name\": \"varActionGroupIds\",\r\n                      \"count\": \"[[length(parameters('BYOActionGroup'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"actionGroupId\": \"[[trim(parameters('BYOActionGroup')[copyIndex('varActionGroupIds')])]\"\r\n                      }\r\n                    }\r\n                  ]\r\n                },\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"ServiceHealthIncident\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[resourceId('Microsoft.Resources/resourceGroups', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"ALZMonitorActionGroupEmail\": {\r\n                            \"type\": \"Array\"\r\n                          },\r\n                          \"BYOActionGroup\": {\r\n                            \"type\": \"array\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"microsoft.insights/activityLogAlerts\",\r\n                            \"apiVersion\": \"2020-10-01\",\r\n                            \"name\": \"ServiceHealthIncident\",\r\n                            \"location\": \"global\",\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"actions\": {\r\n                                \"actionGroups\": \"[[if(empty(parameters('BYOActionGroup')), array(createObject('actionGroupId', concat(subscription().Id, '/resourceGroups/', parameters('alertResourceGroupName'), '/providers/microsoft.insights/actionGroups/', 'ag-AMBA-SH-', subscription().displayName, '-001'))), variables('varActionGroupIds'))]\"\r\n                              },\r\n                              \"description\": \"Service Health Incident Alert\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().id]\"\r\n                              ],\r\n                              \"condition\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"category\",\r\n                                    \"equals\": \"ServiceHealth\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"properties.incidentType\",\r\n                                    \"equals\": \"Incident\"\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"parameters\": {\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"ALZMonitorActionGroupEmail\": {\r\n                          \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                        },\r\n                        \"BYOActionGroup\": {\r\n                          \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"ALZMonitorActionGroupEmail\": {\r\n                  \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                },\r\n                \"BYOActionGroup\": {\r\n                  \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#4": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_activitylog_ServiceHealth_Maintenance\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Service Health Maintenance Alert\",\r\n    \"description\": \"Policy to audit/deploy Service Health Maintenance Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.5.0\",\r\n      \"category\": \"Monitoring\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"_deployed_by_amba\": true\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"disabled\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      },\r\n      \"ALZMonitorActionGroupEmail\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Action Group Email Addresses\",\r\n          \"description\": \"Email addresses to send alerts to\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"BYOActionGroup\": {\r\n        \"type\": \"array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Customer defined Action Group Resource IDs\",\r\n          \"description\": \"The Resource IDs of existing Action Groups currently deployed in the environment.\"\r\n        },\r\n        \"defaultValue\": []\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/activityLogAlerts\",\r\n          \"existenceScope\": \"resourcegroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/ActivityLogAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": true\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                        \"contains\": \"ag-AMBA-SH-\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": false\r\n                      },\r\n                      {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*]\",\r\n                          \"where\": {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                                \"in\": \"[[parameters('BYOActionGroup')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"greaterOrEquals\": 1\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"category\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"ServiceHealth\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"microsoft.insights/activityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"properties.incidentType\"\r\n                          },\r\n                          {\r\n                            \"field\": \"microsoft.insights/activityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"Maintenance\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"equals\": 2\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"ALZMonitorActionGroupEmail\": {\r\n                    \"type\": \"Array\"\r\n                  },\r\n                  \"BYOActionGroup\": {\r\n                    \"type\": \"array\"\r\n                  }\r\n                },\r\n                \"variables\": {\r\n                  \"copy\": [\r\n                    {\r\n                      \"name\": \"varActionGroupIds\",\r\n                      \"count\": \"[[length(parameters('BYOActionGroup'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"actionGroupId\": \"[[trim(parameters('BYOActionGroup')[copyIndex('varActionGroupIds')])]\"\r\n                      }\r\n                    }\r\n                  ]\r\n                },\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"ServiceHealthPlannedMaintenance\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[resourceId('Microsoft.Resources/resourceGroups', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"ALZMonitorActionGroupEmail\": {\r\n                            \"type\": \"Array\"\r\n                          },\r\n                          \"BYOActionGroup\": {\r\n                            \"type\": \"array\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"microsoft.insights/activityLogAlerts\",\r\n                            \"apiVersion\": \"2020-10-01\",\r\n                            \"name\": \"ServiceHealthPlannedMaintenance\",\r\n                            \"location\": \"global\",\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"actions\": {\r\n                                \"actionGroups\": \"[[if(empty(parameters('BYOActionGroup')), array(createObject('actionGroupId', concat(subscription().Id, '/resourceGroups/', parameters('alertResourceGroupName'), '/providers/microsoft.insights/actionGroups/', 'ag-AMBA-SH-', subscription().displayName, '-001'))), variables('varActionGroupIds'))]\"\r\n                              },\r\n                              \"description\": \"Service Health Planned Maintenance Alert\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().id]\"\r\n                              ],\r\n                              \"condition\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"category\",\r\n                                    \"equals\": \"ServiceHealth\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"properties.incidentType\",\r\n                                    \"equals\": \"Maintenance\"\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"parameters\": {\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"ALZMonitorActionGroupEmail\": {\r\n                          \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                        },\r\n                        \"BYOActionGroup\": {\r\n                          \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"ALZMonitorActionGroupEmail\": {\r\n                  \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                },\r\n                \"BYOActionGroup\": {\r\n                  \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#5": "{\r\n  \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n  \"apiVersion\": \"2021-06-01\",\r\n  \"name\": \"Deploy_activitylog_ServiceHealth_SecurityAdvisory\",\r\n  \"properties\": {\r\n    \"policyType\": \"Custom\",\r\n    \"mode\": \"All\",\r\n    \"displayName\": \"Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) - Service Health Security Advisory Alert\",\r\n    \"description\": \"Policy to audit/deploy Service Health Security Advisory Alert\",\r\n    \"metadata\": {\r\n      \"version\": \"1.5.0\",\r\n      \"category\": \"Monitoring\",\r\n      \"source\": \"https://github.com/Azure/azure-monitor-baseline-alerts/\",\r\n      \"alzCloudEnvironments\": [\r\n        \"AzureCloud\"\r\n      ],\r\n      \"_deployed_by_amba\": \"True\"\r\n    },\r\n    \"parameters\": {\r\n      \"enabled\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Alert State\",\r\n          \"description\": \"Alert state for the alert\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"true\",\r\n          \"false\"\r\n        ],\r\n        \"defaultValue\": \"true\"\r\n      },\r\n      \"alertResourceGroupName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Name\",\r\n          \"description\": \"Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"rg-amba-monitoring-001\"\r\n      },\r\n      \"alertResourceGroupTags\": {\r\n        \"type\": \"Object\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Tags\",\r\n          \"description\": \"Tags on the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": {\r\n          \"_deployed_by_amba\": true\r\n        }\r\n      },\r\n      \"alertResourceGroupLocation\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Resource Group Location\",\r\n          \"description\": \"Location of the Resource group the alert is placed in\"\r\n        },\r\n        \"defaultValue\": \"centralus\"\r\n      },\r\n      \"effect\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Effect\",\r\n          \"description\": \"Effect of the policy\"\r\n        },\r\n        \"allowedValues\": [\r\n          \"deployIfNotExists\",\r\n          \"disabled\"\r\n        ],\r\n        \"defaultValue\": \"disabled\"\r\n      },\r\n      \"MonitorDisableTagName\": {\r\n        \"type\": \"String\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag name\",\r\n          \"description\": \"Tag name to disable monitoring. Set to true if monitoring should be disabled\"\r\n        },\r\n        \"defaultValue\": \"MonitorDisable\"\r\n      },\r\n      \"MonitorDisableTagValues\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"ALZ Monitoring disabled tag values(s)\",\r\n          \"description\": \"Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled.\"\r\n        },\r\n        \"defaultValue\": [\r\n          \"true\",\r\n          \"Test\",\r\n          \"Dev\",\r\n          \"Sandbox\"\r\n        ]\r\n      },\r\n      \"ALZMonitorActionGroupEmail\": {\r\n        \"type\": \"Array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Action Group Email Addresses\",\r\n          \"description\": \"Email addresses to send alerts to\"\r\n        },\r\n        \"defaultValue\": []\r\n      },\r\n      \"BYOActionGroup\": {\r\n        \"type\": \"array\",\r\n        \"metadata\": {\r\n          \"displayName\": \"Customer defined Action Group Resource IDs\",\r\n          \"description\": \"The Resource IDs of existing Action Groups currently deployed in the environment.\"\r\n        },\r\n        \"defaultValue\": []\r\n      }\r\n    },\r\n    \"policyRule\": {\r\n      \"if\": {\r\n        \"allOf\": [\r\n          {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          {\r\n            \"field\": \"[[concat('tags[', parameters('MonitorDisableTagName'), ']')]\",\r\n            \"notIn\": \"[[parameters('MonitorDisableTagValues')]\"\r\n          }\r\n        ]\r\n      },\r\n      \"then\": {\r\n        \"effect\": \"[[parameters('effect')]\",\r\n        \"details\": {\r\n          \"roleDefinitionIds\": [\r\n            \"/providers/Microsoft.Authorization/roleDefinitions/47be4a87-7950-4631-9daf-b664a405f074\"\r\n          ],\r\n          \"type\": \"Microsoft.Insights/activityLogAlerts\",\r\n          \"existenceScope\": \"resourcegroup\",\r\n          \"resourceGroupName\": \"[[parameters('alertResourceGroupName')]\",\r\n          \"deploymentScope\": \"subscription\",\r\n          \"existenceCondition\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Insights/ActivityLogAlerts/enabled\",\r\n                \"equals\": \"[[parameters('enabled')]\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": true\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                        \"contains\": \"ag-AMBA-SH-\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[[empty(parameters('BYOActionGroup'))]\",\r\n                        \"equals\": false\r\n                      },\r\n                      {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*]\",\r\n                          \"where\": {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/actions.actionGroups[*].actionGroupId\",\r\n                                \"in\": \"[[parameters('BYOActionGroup')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"greaterOrEquals\": 1\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"category\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"ServiceHealth\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"microsoft.insights/activityLogAlerts/condition.allOf[*].field\",\r\n                            \"equals\": \"properties.incidentType\"\r\n                          },\r\n                          {\r\n                            \"field\": \"microsoft.insights/activityLogAlerts/condition.allOf[*].equals\",\r\n                            \"equals\": \"Security\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"equals\": 2\r\n              }\r\n            ]\r\n          },\r\n          \"deployment\": {\r\n            \"location\": \"northeurope\",\r\n            \"properties\": {\r\n              \"mode\": \"incremental\",\r\n              \"template\": {\r\n                \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                \"contentVersion\": \"1.0.0.0\",\r\n                \"parameters\": {\r\n                  \"alertResourceGroupName\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"alertResourceGroupTags\": {\r\n                    \"type\": \"object\"\r\n                  },\r\n                  \"alertResourceGroupLocation\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"enabled\": {\r\n                    \"type\": \"string\"\r\n                  },\r\n                  \"ALZMonitorActionGroupEmail\": {\r\n                    \"type\": \"Array\"\r\n                  },\r\n                  \"BYOActionGroup\": {\r\n                    \"type\": \"array\"\r\n                  }\r\n                },\r\n                \"variables\": {\r\n                  \"copy\": [\r\n                    {\r\n                      \"name\": \"varActionGroupIds\",\r\n                      \"count\": \"[[length(parameters('BYOActionGroup'))]\",\r\n                      \"mode\": \"serial\",\r\n                      \"input\": {\r\n                        \"actionGroupId\": \"[[trim(parameters('BYOActionGroup')[copyIndex('varActionGroupIds')])]\"\r\n                      }\r\n                    }\r\n                  ]\r\n                },\r\n                \"resources\": [\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                    \"apiVersion\": \"2021-04-01\",\r\n                    \"name\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"location\": \"[[parameters('alertResourceGroupLocation')]\",\r\n                    \"tags\": \"[[parameters('alertResourceGroupTags')]\"\r\n                  },\r\n                  {\r\n                    \"type\": \"Microsoft.Resources/deployments\",\r\n                    \"apiVersion\": \"2019-10-01\",\r\n                    \"name\": \"ServiceHealthSecurityIncident\",\r\n                    \"resourceGroup\": \"[[parameters('alertResourceGroupName')]\",\r\n                    \"dependsOn\": [\r\n                      \"[[resourceId('Microsoft.Resources/resourceGroups', parameters('alertResourceGroupName'))]\"\r\n                    ],\r\n                    \"properties\": {\r\n                      \"mode\": \"Incremental\",\r\n                      \"template\": {\r\n                        \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                        \"contentVersion\": \"1.0.0.0\",\r\n                        \"parameters\": {\r\n                          \"enabled\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"alertResourceGroupName\": {\r\n                            \"type\": \"string\"\r\n                          },\r\n                          \"ALZMonitorActionGroupEmail\": {\r\n                            \"type\": \"Array\"\r\n                          },\r\n                          \"BYOActionGroup\": {\r\n                            \"type\": \"array\"\r\n                          }\r\n                        },\r\n                        \"variables\": {},\r\n                        \"resources\": [\r\n                          {\r\n                            \"type\": \"microsoft.insights/activityLogAlerts\",\r\n                            \"apiVersion\": \"2020-10-01\",\r\n                            \"name\": \"ServiceHealthSecurityIncident\",\r\n                            \"location\": \"global\",\r\n                            \"tags\": {\r\n                              \"_deployed_by_amba\": true\r\n                            },\r\n                            \"properties\": {\r\n                              \"actions\": {\r\n                                \"actionGroups\": \"[[if(empty(parameters('BYOActionGroup')), array(createObject('actionGroupId', concat(subscription().Id, '/resourceGroups/', parameters('alertResourceGroupName'), '/providers/microsoft.insights/actionGroups/', 'ag-AMBA-SH-', subscription().displayName, '-001'))), variables('varActionGroupIds'))]\"\r\n                              },\r\n                              \"description\": \"Service Health Security Alert\",\r\n                              \"enabled\": \"[[parameters('enabled')]\",\r\n                              \"scopes\": [\r\n                                \"[[subscription().id]\"\r\n                              ],\r\n                              \"condition\": {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"category\",\r\n                                    \"equals\": \"ServiceHealth\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"properties.incidentType\",\r\n                                    \"equals\": \"Security\"\r\n                                  }\r\n                                ]\r\n                              },\r\n                              \"parameters\": {\r\n                                \"enabled\": {\r\n                                  \"value\": \"[[parameters('enabled')]\"\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"parameters\": {\r\n                        \"enabled\": {\r\n                          \"value\": \"[[parameters('enabled')]\"\r\n                        },\r\n                        \"alertResourceGroupName\": {\r\n                          \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                        },\r\n                        \"ALZMonitorActionGroupEmail\": {\r\n                          \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                        },\r\n                        \"BYOActionGroup\": {\r\n                          \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              \"parameters\": {\r\n                \"enabled\": {\r\n                  \"value\": \"[[parameters('enabled')]\"\r\n                },\r\n                \"alertResourceGroupName\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupName')]\"\r\n                },\r\n                \"alertResourceGroupTags\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupTags')]\"\r\n                },\r\n                \"alertResourceGroupLocation\": {\r\n                  \"value\": \"[[parameters('alertResourceGroupLocation')]\"\r\n                },\r\n                \"ALZMonitorActionGroupEmail\": {\r\n                  \"value\": \"[[parameters('ALZMonitorActionGroupEmail')]\"\r\n                },\r\n                \"BYOActionGroup\": {\r\n                  \"value\": \"[[parameters('BYOActionGroup')]\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n",
    "$fxv#6": {
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2021-06-01",
      "name": "Alerting-ServiceHealth",
      "properties": {
        "displayName": "Deploy Azure Monitor Baseline Alerts (AMBA-ALZ) for Service Health",
        "description": "This initiative deploys Azure Monitor Baseline Alerts (AMBA-ALZ) to monitor Service Health Events such as Service issues, Planned maintenance, Health advisories, Security advisories, and Resource health.",
        "metadata": {
          "version": "1.5.3",
          "category": "Monitoring",
          "source": "https://github.com/Azure/azure-monitor-baseline-alerts/",
          "alzCloudEnvironments": [
            "AzureCloud"
          ],
          "_deployed_by_amba": true
        },
        "parameters": {
          "ALZMonitorResourceGroupName": {
            "type": "String",
            "defaultValue": "rg-amba-monitoring-001",
            "metadata": {
              "displayName": "Resource Group Name",
              "description": "Name of the resource group to deploy the alerts to"
            }
          },
          "ALZMonitorResourceGroupTags": {
            "type": "Object",
            "defaultValue": {
              "_deployed_by_alz_monitor": true
            },
            "metadata": {
              "displayName": "Resource Group Tags",
              "description": "Tags to apply to the resource group"
            }
          },
          "ALZMonitorResourceGroupLocation": {
            "type": "String",
            "defaultValue": "centralus",
            "metadata": {
              "displayName": "Resource Group Location",
              "description": "Location of the resource group"
            }
          },
          "ALZMonitorDisableTagName": {
            "type": "String",
            "metadata": {
              "displayName": "ALZ Monitoring disabled tag name",
              "description": "Tag name used to disable monitoring at the resource level. Set to true if monitoring should be disabled."
            },
            "defaultValue": "MonitorDisable"
          },
          "ALZMonitorDisableTagValues": {
            "type": "Array",
            "metadata": {
              "displayName": "ALZ Monitoring disabled tag values(s)",
              "description": "Tag value(s) used to disable monitoring at the resource level. Set to true if monitoring should be disabled."
            },
            "defaultValue": [
              "true",
              "Test",
              "Dev",
              "Sandbox"
            ]
          },
          "ResHlthUnhealthyAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Resource Health Unhealthy Alert State",
              "description": "State of the Resource Health Unhealthy alert"
            }
          },
          "ResHlthUnhealthyPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Resource Health Unhealthy Alert Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "SvcHlthAdvisoryAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Service Health Advisory Alert State",
              "description": "State of the Service Health Advisory alert"
            }
          },
          "serviceHealthAdvisoryPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Service Health Advisory Alert Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "SvcHlthIncidentAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Service Health Incident Alert State",
              "description": "State of the Service Health Incident alert"
            }
          },
          "serviceHealthIncidentPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Service Health Incident Alert Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "SvcHlthMaintenanceAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Service Health Maintenance Alert State",
              "description": "State of the Service Health Maintenance alert"
            }
          },
          "serviceHealthMaintenancePolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Service Health Maintenance Alert Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "svcHlthSecAdvisoryAlertState": {
            "type": "string",
            "defaultValue": "true",
            "metadata": {
              "displayName": "Service Health Security Advisory Alert State",
              "description": "State of the Service Health Security Advisory alert"
            }
          },
          "serviceHealthSecurityPolicyEffect": {
            "type": "string",
            "defaultValue": "deployIfNotExists",
            "allowedValues": [
              "deployIfNotExists",
              "disabled"
            ],
            "metadata": {
              "displayName": "Service Health Security Advisory Alert Policy Effect",
              "description": "Policy effect for the alert, deployIfNotExists will deploy the alert if it does not exist"
            }
          },
          "ALZMonitorActionGroupEmail": {
            "type": "Array",
            "defaultValue": [],
            "metadata": {
              "displayName": "Action Group Email Addresses",
              "description": "Email addresses to send alerts to"
            }
          },
          "ALZLogicappResourceId": {
            "type": "String",
            "defaultValue": "",
            "metadata": {
              "displayName": "Logic App Resource Id",
              "description": "Logic App Resource Id for Action Group to send alerts to"
            }
          },
          "ALZLogicappCallbackUrl": {
            "type": "String",
            "metadata": {
              "displayName": "Logic App Callback URL",
              "description": "Callback URL that triggers the Logic App"
            },
            "defaultValue": ""
          },
          "ALZArmRoleId": {
            "type": "array",
            "defaultValue": [],
            "metadata": {
              "displayName": "Arm Role Ids",
              "description": "Arm Built-in Role Ids for action group to send alerts to"
            }
          },
          "ALZEventHubResourceId": {
            "type": "array",
            "defaultValue": [],
            "metadata": {
              "displayName": "Event Hub resource Ids",
              "description": "Event Hub resource Ids for action group to send alerts to"
            }
          },
          "ALZWebhookServiceUri": {
            "type": "Array",
            "metadata": {
              "displayName": "Webhook Service Uri(s)",
              "description": "Indicates the service uri(s) of the webhook to send alerts to"
            },
            "defaultValue": []
          },
          "ALZFunctionResourceId": {
            "type": "String",
            "metadata": {
              "displayName": "Function Resource Id",
              "description": "Function Resource Id for Action Group to send alerts to"
            },
            "defaultValue": ""
          },
          "ALZFunctionTriggerUrl": {
            "type": "String",
            "metadata": {
              "displayName": "Function Trigger URL",
              "description": "URL that triggers the Function App"
            },
            "defaultValue": ""
          },
          "BYOActionGroup": {
            "type": "array",
            "metadata": {
              "displayName": "Customer defined Action Group Resource IDs",
              "description": "The Resource IDs of existing Action Groups currently deployed in the environment."
            },
            "defaultValue": []
          },
          "BYOAlertProcessingRule": {
            "type": "String",
            "metadata": {
              "displayName": "Customer defined Alert Processing Rule Resource ID",
              "description": "The Resource ID of an existing Alert Processing Rule already deployed by the customer in his environment"
            },
            "defaultValue": ""
          }
        },
        "policyDefinitions": [
          {
            "policyDefinitionReferenceId": "ALZ_ServiceHealth_ActionGroups",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_ServiceHealth_ActionGroups",
            "parameters": {
              "ALZMonitorResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "ALZMonitorResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "ALZMonitorResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "ALZMonitorActionGroupEmail": {
                "value": "[[[parameters('ALZMonitorActionGroupEmail')]"
              },
              "ALZLogicappResourceId": {
                "value": "[[[parameters('ALZLogicappResourceId')]"
              },
              "ALZLogicappCallbackUrl": {
                "value": "[[[parameters('ALZLogicappCallbackUrl')]"
              },
              "ALZArmRoleId": {
                "value": "[[[parameters('ALZArmRoleId')]"
              },
              "ALZEventHubResourceId": {
                "value": "[[[parameters('ALZEventHubResourceId')]"
              },
              "ALZWebhookServiceUri": {
                "value": "[[[parameters('ALZWebhookServiceUri')]"
              },
              "ALZFunctionResourceId": {
                "value": "[[[parameters('ALZFunctionResourceId')]"
              },
              "ALZFunctionTriggerUrl": {
                "value": "[[[parameters('ALZFunctionTriggerUrl')]"
              },
              "BYOActionGroup": {
                "value": "[[[parameters('BYOActionGroup')]"
              },
              "BYOAlertProcessingRule": {
                "value": "[[[parameters('BYOAlertProcessingRule')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_ResHlthUnhealthy",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_activitylog_ResourceHealth_Unhealthy_Alert",
            "parameters": {
              "enabled": {
                "value": "[[[parameters('ResHlthUnhealthyAlertState')]"
              },
              "effect": {
                "value": "[[[parameters('ResHlthUnhealthyPolicyEffect')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "BYOActionGroup": {
                "value": "[[[parameters('BYOActionGroup')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SvcHlthAdvisory",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_activitylog_ServiceHealth_HealthAdvisory",
            "parameters": {
              "enabled": {
                "value": "[[[parameters('SvcHlthAdvisoryAlertState')]"
              },
              "effect": {
                "value": "[[[parameters('serviceHealthAdvisoryPolicyEffect')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "ALZMonitorActionGroupEmail": {
                "value": "[[[parameters('ALZMonitorActionGroupEmail')]"
              },
              "BYOActionGroup": {
                "value": "[[[parameters('BYOActionGroup')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SvcHlthIncident",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_activitylog_ServiceHealth_Incident",
            "parameters": {
              "enabled": {
                "value": "[[[parameters('SvcHlthIncidentAlertState')]"
              },
              "effect": {
                "value": "[[[parameters('serviceHealthIncidentPolicyEffect')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "ALZMonitorActionGroupEmail": {
                "value": "[[[parameters('ALZMonitorActionGroupEmail')]"
              },
              "BYOActionGroup": {
                "value": "[[[parameters('BYOActionGroup')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_SvcHlthMaintenance",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_activitylog_ServiceHealth_Maintenance",
            "parameters": {
              "enabled": {
                "value": "[[[parameters('SvcHlthMaintenanceAlertState')]"
              },
              "effect": {
                "value": "[[[parameters('serviceHealthMaintenancePolicyEffect')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "BYOActionGroup": {
                "value": "[[[parameters('BYOActionGroup')]"
              },
              "ALZMonitorActionGroupEmail": {
                "value": "[[[parameters('ALZMonitorActionGroupEmail')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          },
          {
            "policyDefinitionReferenceId": "ALZ_svcHlthSecAdvisory",
            "policyDefinitionId": "/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/Deploy_activitylog_ServiceHealth_SecurityAdvisory",
            "parameters": {
              "enabled": {
                "value": "[[[parameters('svcHlthSecAdvisoryAlertState')]"
              },
              "effect": {
                "value": "[[[parameters('serviceHealthSecurityPolicyEffect')]"
              },
              "alertResourceGroupName": {
                "value": "[[[parameters('ALZMonitorResourceGroupName')]"
              },
              "alertResourceGroupTags": {
                "value": "[[[parameters('ALZMonitorResourceGroupTags')]"
              },
              "alertResourceGroupLocation": {
                "value": "[[[parameters('ALZMonitorResourceGroupLocation')]"
              },
              "ALZMonitorActionGroupEmail": {
                "value": "[[[parameters('ALZMonitorActionGroupEmail')]"
              },
              "BYOActionGroup": {
                "value": "[[[parameters('BYOActionGroup')]"
              },
              "MonitorDisableTagName": {
                "value": "[[[parameters('ALZMonitorDisableTagName')]"
              },
              "MonitorDisableTagValues": {
                "value": "[[[parameters('ALZMonitorDisableTagValues')]"
              }
            }
          }
        ],
        "policyType": "Custom",
        "policyDefinitionGroups": null
      }
    },
    "cloudEnv": "[environment().name]",
    "defaultDeploymentLocationByCloudType": {
      "AzureCloud": "northeurope",
      "AzureChinaCloud": "chinaeast2",
      "AzureUSGovernment": "usgovvirginia"
    },
    "templateVars": {
      "scope": "/providers/Microsoft.Management/managementGroups/contoso",
      "defaultDeploymentLocation": "\"location\": \"northeurope\"",
      "localizedDeploymentLocation": "[format('\"location\": \"{0}\"', variables('defaultDeploymentLocationByCloudType')[variables('cloudEnv')])]"
    },
    "targetDeploymentLocationByCloudType": {
      "AzureCloud": "[coalesce(parameters('location'), 'northeurope')]",
      "AzureChinaCloud": "[coalesce(parameters('location'), 'chinaeast2')]",
      "AzureUSGovernment": "[coalesce(parameters('location'), 'usgovvirginia')]"
    },
    "deploymentLocation": "[format('\"location\": \"{0}\"', variables('targetDeploymentLocationByCloudType')[variables('cloudEnv')])]",
    "loadPolicyDefinitions": {
      "All": [
        "[variables('$fxv#0')]",
        "[variables('$fxv#1')]",
        "[variables('$fxv#2')]",
        "[variables('$fxv#3')]",
        "[variables('$fxv#4')]",
        "[variables('$fxv#5')]"
      ],
      "AzureCloud": [],
      "AzureChinaCloud": [],
      "AzureUSGovernment": []
    },
    "loadPolicySetDefinitions": {
      "All": [
        "[string(variables('$fxv#6'))]"
      ],
      "AzureCloud": [],
      "AzureChinaCloud": [],
      "AzureUSGovernment": []
    },
    "policyDefinitionsByCloudType": {
      "All": "[variables('policyDefinitionsAll')]",
      "AzureCloud": "[variables('policyDefinitionsAzureCloud')]",
      "AzureChinaCloud": "[variables('policyDefinitionsAzureChinaCloud')]",
      "AzureUSGovernment": "[variables('policyDefinitionsAzureUSGovernment')]"
    },
    "policySetDefinitionsByCloudType": {
      "All": "[variables('policySetDefinitionsAll')]",
      "AzureCloud": "[variables('policySetDefinitionsAzureCloud')]",
      "AzureChinaCloud": "[variables('policySetDefinitionsAzureChinaCloud')]",
      "AzureUSGovernment": "[variables('policySetDefinitionsAzureUSGovernment')]"
    },
    "policyDefinitions": "[concat(variables('policyDefinitionsByCloudType').All, variables('policyDefinitionsByCloudType')[variables('cloudEnv')])]",
    "policySetDefinitions": "[concat(variables('policySetDefinitionsByCloudType').All, variables('policySetDefinitionsByCloudType')[variables('cloudEnv')])]"
  },
  "resources": [
    {
      "copy": {
        "name": "PolicyDefinitions",
        "count": "[length(variables('policyDefinitions'))]"
      },
      "type": "Microsoft.Authorization/policyDefinitions",
      "apiVersion": "2020-09-01",
      "name": "[variables('policyDefinitions')[copyIndex()].name]",
      "properties": {
        "description": "[variables('policyDefinitions')[copyIndex()].properties.description]",
        "displayName": "[variables('policyDefinitions')[copyIndex()].properties.displayName]",
        "metadata": "[variables('policyDefinitions')[copyIndex()].properties.metadata]",
        "mode": "[variables('policyDefinitions')[copyIndex()].properties.mode]",
        "parameters": "[variables('policyDefinitions')[copyIndex()].properties.parameters]",
        "policyType": "[variables('policyDefinitions')[copyIndex()].properties.policyType]",
        "policyRule": "[variables('policyDefinitions')[copyIndex()].properties.policyRule]"
      }
    },
    {
      "copy": {
        "name": "PolicySetDefinitions",
        "count": "[length(variables('policySetDefinitions'))]"
      },
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2020-09-01",
      "name": "[variables('policySetDefinitions')[copyIndex()].name]",
      "properties": {
        "description": "[variables('policySetDefinitions')[copyIndex()].properties.description]",
        "displayName": "[variables('policySetDefinitions')[copyIndex()].properties.displayName]",
        "metadata": "[variables('policySetDefinitions')[copyIndex()].properties.metadata]",
        "parameters": "[variables('policySetDefinitions')[copyIndex()].properties.parameters]",
        "policyType": "[variables('policySetDefinitions')[copyIndex()].properties.policyType]",
        "policyDefinitions": "[variables('policySetDefinitions')[copyIndex()].properties.policyDefinitions]",
        "policyDefinitionGroups": "[variables('policySetDefinitions')[copyIndex()].properties.policyDefinitionGroups]"
      },
      "dependsOn": [
        "PolicyDefinitions"
      ]
    }
  ],
  "outputs": {
    "policyDefinitionNames": {
      "type": "array",
      "copy": {
        "count": "[length(variables('policyDefinitions'))]",
        "input": "[variables('policyDefinitions')[copyIndex()].name]"
      }
    },
    "policySetDefinitionNames": {
      "type": "array",
      "copy": {
        "count": "[length(variables('policySetDefinitions'))]",
        "input": "[variables('policySetDefinitions')[copyIndex()].name]"
      }
    }
  }
}